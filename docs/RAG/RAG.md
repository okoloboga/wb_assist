# RAG-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è WB Assist - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**RAG (Retrieval-Augmented Generation)** ‚Äî —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ AI-—á–∞—Ç–∞ –∑–∞ —Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Wildberries. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–±—â–∏–µ –∑–Ω–∞–Ω–∏—è LLM, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∑–∞–∫–∞–∑–∞–º, –æ—Å—Ç–∞—Ç–∫–∞–º, –æ—Ç–∑—ã–≤–∞–º, –ø—Ä–æ–¥–∞–∂–∞–º –∏ —Ç–æ–≤–∞—Ä–∞–º.

### –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
–°–æ–∑–¥–∞—Ç—å MVP RAG-—Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è:
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ PostgreSQL –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±–æ–≥–∞—â–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è ChatGPT –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º AI Chat —Å–µ—Ä–≤–∏—Å–æ–º (–ø–æ—Ä—Ç 9001)

### –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è MVP
- ‚ö° –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫ ‚Üí –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
- üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º ChatGPT —Å–µ—Ä–≤–∏—Å–æ–º (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π)
- üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pgvector –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- üéØ –§–æ–∫—É—Å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö Wildberries: –∑–∞–∫–∞–∑—ã, —Ç–æ–≤–∞—Ä—ã, –æ—Å—Ç–∞—Ç–∫–∏, –æ—Ç–∑—ã–≤—ã, –ø—Ä–æ–¥–∞–∂–∏
- üìà –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Ñ–∏–ª—å—Ç—Ä—ã)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ
‚îÇ   (port 8001)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ POST /v1/chat/send
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              AI Chat Service (port 9001)                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  RAG Module (–Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  1. Query Understanding                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚îÄ‚ñ∫ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  2. Vector Search                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚îÄ‚ñ∫ –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ pgvector       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  3. Context Assembly                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚îÄ‚ñ∫ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  4. Prompt Enrichment                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚îÄ‚ñ∫ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚îÇ                              ‚îÇ
‚îÇ                          ‚ñº                              ‚îÇ
‚îÇ              –û–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç ‚Üí OpenAI API            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Main Server (port 8000)                    ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ   PostgreSQL     ‚îÇ      ‚îÇ   PostgreSQL    ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  (–û—Å–Ω–æ–≤–Ω–∞—è –ë–î)   ‚îÇ      ‚îÇ  (–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î) ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ      ‚îÇ  + pgvector    ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_orders      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                 ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_products    ‚îÇ      ‚îÇ ‚Ä¢ embeddings   ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_stocks     ‚îÇ      ‚îÇ ‚Ä¢ metadata     ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_reviews    ‚îÇ      ‚îÇ ‚Ä¢ chunks       ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_sales      ‚îÇ      ‚îÇ                 ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ wb_cabinets   ‚îÇ      ‚îÇ                 ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. **RAG Module** (–≤–Ω—É—Ç—Ä–∏ AI Chat Service)
–ù–æ–≤—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π AI Chat —Å–µ—Ä–≤–∏—Å. –ù–µ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∞ —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `gpt_integration/ai_chat/rag/`

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **Query Processor** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Vector Search Engine** ‚Äî –ø–æ–∏—Å–∫ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
- **Context Builder** ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Prompt Enricher** ‚Äî –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

#### 2. **Vector Database** (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `pgvector` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö.

**–¢–∞–±–ª–∏—Ü—ã:**
- `rag_embeddings` ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `rag_metadata` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–≤—è–∑–∏ —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `rag_index_status` ‚Äî —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)

#### 3. **Indexing Service** (—Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å)
–°–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç—å—é –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (Celery task) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

---

## üîÑ –ü–∞–π–ø–ª–∞–π–Ω RAG (MVP)

### –≠—Ç–∞–ø 1: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª—å:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL –≤ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î**
   - –ó–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–∞–º: `wb_orders`, `wb_products`, `wb_stocks`, `wb_reviews`, `wb_sales`
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `cabinet_id` (–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π –¥–ª—è –∑–∞–∫–∞–∑–æ–≤)

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤ (chunks)**
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
   - –ü—Ä–∏–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤:
     - **–ó–∞–∫–∞–∑:** "–ó–∞–∫–∞–∑ #12345 –æ—Ç 2025-01-15: —Ç–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), —Ä–∞–∑–º–µ—Ä M, —Ü–µ–Ω–∞ 2500‚ÇΩ, —Å—Ç–∞—Ç—É—Å: –≤—ã–∫—É–ø–ª–µ–Ω"
     - **–¢–æ–≤–∞—Ä:** "–¢–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), –±—Ä–µ–Ω–¥: Fashion, –∫–∞—Ç–µ–≥–æ—Ä–∏—è: –û–¥–µ–∂–¥–∞, —Ä–µ–π—Ç–∏–Ω–≥: 4.5, –æ—Ç–∑—ã–≤–æ–≤: 120, —Ü–µ–Ω–∞: 2500‚ÇΩ"
     - **–û—Å—Ç–∞—Ç–æ–∫:** "–û—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞ '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), —Ä–∞–∑–º–µ—Ä M, —Å–∫–ª–∞–¥: –ú–æ—Å–∫–≤–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 15 —à—Ç"
     - **–û—Ç–∑—ã–≤:** "–û—Ç–∑—ã–≤ –Ω–∞ —Ç–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456): —Ä–µ–π—Ç–∏–Ω–≥ 5‚≠ê, –¥–∞—Ç–∞: 2025-01-10, —Ç–µ–∫—Å—Ç: '–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ'"
     - **–ü—Ä–æ–¥–∞–∂–∞:** "–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–∞ '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456) –æ—Ç 2025-01-12: —Ç–∏–ø - –≤—ã–∫—É–ø, —Å—É–º–º–∞: 2500‚ÇΩ"

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `text-embedding-3-small` –æ—Ç OpenAI)
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (embedding)
   - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–∞: 1536 (–¥–ª—è OpenAI embeddings)

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ embedding –≤ —Ç–∞–±–ª–∏—Ü—É `rag_embeddings` (—Ç–∏–ø `vector(1536)`)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É `rag_metadata`:
     - `source_table` ‚Äî –∏—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (wb_orders, wb_products –∏ —Ç.–¥.)
     - `source_id` ‚Äî ID –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
     - `cabinet_id` ‚Äî ID –∫–∞–±–∏–Ω–µ—Ç–∞ (–¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
     - `chunk_text` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞
     - `chunk_type` ‚Äî —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö (order, product, stock, review, sale)
     - `created_at` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
     - `updated_at` ‚Äî –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ß–∞—Å—Ç–æ—Ç–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (MVP):**
- –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è: –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –∏–ª–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (–∏–ª–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —á–µ—Ä–µ–∑ Celery)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è):**
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ `cabinet_id` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `cabinet_id` –∏ `chunk_type` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ —Å—Ç–∞—Ä—à–µ 180 –¥–Ω–µ–π)

---

### –≠—Ç–∞–ø 2: –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (Query Understanding)

**–¶–µ–ª—å:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞**
   - –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (intent):
     - **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂** ‚Äî –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ `wb_sales`, `wb_orders`
     - **–í–æ–ø—Ä–æ—Å—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö** ‚Äî –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ `wb_products`, `wb_reviews`
     - **–û—Å—Ç–∞—Ç–∫–∏ –∏ —Å–∫–ª–∞–¥** ‚Äî –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ `wb_stocks`
     - **–û—Ç–∑—ã–≤—ã** ‚Äî –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ `wb_reviews`
     - **–û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã** ‚Äî –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π**
   - –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π:
     - `nm_id` (–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–Ω—ã–π ID —Ç–æ–≤–∞—Ä–∞)
     - –ù–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
     - –î–∞—Ç—ã (—Å–µ–≥–æ–¥–Ω—è, –≤—á–µ—Ä–∞, –∑–∞ –Ω–µ–¥–µ–ª—é)
     - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
     - –ë—Ä–µ–Ω–¥—ã

3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞**
   - –°–æ–∑–¥–∞–Ω–∏–µ query embedding –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–π –∂–µ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, —á—Ç–æ –∏ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–õ–æ–≥–∏–∫–∞ (MVP):**
- –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ NLP)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `cabinet_id` (—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–±—É–¥—É—â–µ–µ):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ NER (Named Entity Recognition)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏

---

### –≠—Ç–∞–ø 3: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (Vector Search)

**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `cosine similarity` –∏–ª–∏ `L2 distance` –≤ pgvector
   - –ü–æ–∏—Å–∫ —Ç–æ–ø-K –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, K=5-10 –¥–ª—è MVP)
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `cabinet_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `chunk_type` (–µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞)

2. **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ similarity score (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
   - –ü–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π similarity score (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.7)
   - –ï—Å–ª–∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç)

3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞ –∏–∑ `rag_metadata`

**SQL-–∑–∞–ø—Ä–æ—Å (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `<->` –∏–ª–∏ `<#>` –≤ pgvector –¥–ª—è –ø–æ–∏—Å–∫–∞
- JOIN —Å —Ç–∞–±–ª–∏—Ü–µ–π `rag_metadata` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- WHERE —É—Å–ª–æ–≤–∏—è: `cabinet_id = ?` –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `chunk_type IN (...)`

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò–Ω–¥–µ–∫—Å HNSW –Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (LIMIT)

---

### –≠—Ç–∞–ø 4: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Context Assembly)

**–¶–µ–ª—å:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–∞–Ω–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —á–∞–Ω–∫–æ–≤**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É –¥–∞–Ω–Ω—ã—Ö (orders, products, stocks –∏ —Ç.–¥.)
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (similarity score)

2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–µ—Å–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–≤–∞—Ä/–∑–∞–∫–∞–∑ –Ω–∞–π–¥–µ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

3. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —á–∞–Ω–∫–æ–≤ –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–æ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö:
     ```
     === –î–ê–ù–ù–´–ï –û –ó–ê–ö–ê–ó–ê–• ===
     [–ß–∞–Ω–∫ 1]
     [–ß–∞–Ω–∫ 2]
     
     === –î–ê–ù–ù–´–ï –û –¢–û–í–ê–†–ê–• ===
     [–ß–∞–Ω–∫ 3]
     ...
     ```

4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: ~2000-3000 —Å–∏–º–≤–æ–ª–æ–≤ (–¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤)
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —á–∞–Ω–∫–∞–º
   - –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Äî –æ–±—Ä–µ–∑–∫–∞ –º–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞—Å—Ç–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø—Ä–∏–º–µ—Ä):**
```
=== –†–ï–õ–ï–í–ê–ù–¢–ù–´–ï –î–ê–ù–ù–´–ï –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–• ===

–ó–ê–ö–ê–ó–´:
- –ó–∞–∫–∞–∑ #12345 –æ—Ç 2025-01-15: —Ç–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), —Ä–∞–∑–º–µ—Ä M, —Ü–µ–Ω–∞ 2500‚ÇΩ, —Å—Ç–∞—Ç—É—Å: –≤—ã–∫—É–ø–ª–µ–Ω
- –ó–∞–∫–∞–∑ #12346 –æ—Ç 2025-01-14: —Ç–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), —Ä–∞–∑–º–µ—Ä S, —Ü–µ–Ω–∞ 2500‚ÇΩ, —Å—Ç–∞—Ç—É—Å: –≤—ã–∫—É–ø–ª–µ–Ω

–¢–û–í–ê–†–´:
- –¢–æ–≤–∞—Ä '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), –±—Ä–µ–Ω–¥: Fashion, –∫–∞—Ç–µ–≥–æ—Ä–∏—è: –û–¥–µ–∂–¥–∞, —Ä–µ–π—Ç–∏–Ω–≥: 4.5, –æ—Ç–∑—ã–≤–æ–≤: 120, —Ü–µ–Ω–∞: 2500‚ÇΩ

–û–°–¢–ê–¢–ö–ò:
- –û—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞ '–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ' (nm_id: 123456), —Ä–∞–∑–º–µ—Ä M, —Å–∫–ª–∞–¥: –ú–æ—Å–∫–≤–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 15 —à—Ç
```

---

### –≠—Ç–∞–ø 5: –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (Prompt Enrichment)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ ChatGPT.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞**
   - –í–∑—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `SYSTEM_PROMPT` –∏–∑ AI Chat —Å–µ—Ä–≤–∏—Å–∞
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–æ–≥–∞—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
     ```
     [–ò—Å—Ö–æ–¥–Ω—ã–π SYSTEM_PROMPT]
     
     === –ö–û–ù–¢–ï–ö–°–¢ –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===
     [–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —ç—Ç–∞–ø–∞ 4]
     
     === –ò–ù–°–¢–†–£–ö–¶–ò–ò ===
     –ò—Å–ø–æ–ª—å–∑—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã—à–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
     –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –æ—Ç–≤–µ—á–∞–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–∏—Ö –∑–Ω–∞–Ω–∏–π, –Ω–æ —É–∫–∞–∂–∏ —ç—Ç–æ.
     ```

2. **–ü–µ—Ä–µ–¥–∞—á–∞ –æ–±–æ–≥–∞—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –≤ OpenAI**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `_call_openai()` –≤ AI Chat —Å–µ—Ä–≤–∏—Å–µ
   - –û–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ `system` —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ `user` —Å–æ–æ–±—â–µ–Ω–∏–µ

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞**
   - –û—Ç–≤–µ—Ç –æ—Ç ChatGPT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è RAG (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)

**Fallback –ª–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ –Ω–∞—à–µ–ª —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (similarity < –ø–æ—Ä–æ–≥–∞) ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ ‚Üí fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Üí –æ–±—Ä–µ–∑–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–ø-3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ 1: `rag_embeddings`

–•—Ä–∞–Ω–∏—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (SERIAL PRIMARY KEY)
- `embedding` ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (vector(1536) –¥–ª—è OpenAI embeddings)
- `metadata_id` ‚Äî –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ `rag_metadata.id`
- `created_at` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (TIMESTAMP)
- `updated_at` ‚Äî –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- HNSW –∏–Ω–¥–µ–∫—Å –Ω–∞ `embedding` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ò–Ω–¥–µ–∫—Å –Ω–∞ `metadata_id` –¥–ª—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π

### –¢–∞–±–ª–∏—Ü–∞ 2: `rag_metadata`

–•—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–æ–≤.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (SERIAL PRIMARY KEY)
- `cabinet_id` ‚Äî ID –∫–∞–±–∏–Ω–µ—Ç–∞ Wildberries (INTEGER, NOT NULL, INDEX)
- `source_table` ‚Äî –∏—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (VARCHAR(50), NOT NULL): 'wb_orders', 'wb_products', 'wb_stocks', 'wb_reviews', 'wb_sales'
- `source_id` ‚Äî ID –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (INTEGER, NOT NULL)
- `chunk_type` ‚Äî —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö (VARCHAR(20), NOT NULL, INDEX): 'order', 'product', 'stock', 'review', 'sale'
- `chunk_text` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞ (TEXT, NOT NULL)
- `created_at` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (TIMESTAMP, INDEX)
- `updated_at` ‚Äî –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (TIMESTAMP)

**–ò–Ω–¥–µ–∫—Å—ã:**
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(cabinet_id, chunk_type)` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å –Ω–∞ `source_table` –∏ `source_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ò–Ω–¥–µ–∫—Å –Ω–∞ `created_at` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- UNIQUE –Ω–∞ `(cabinet_id, source_table, source_id)` ‚Äî –æ–¥–∏–Ω —á–∞–Ω–∫ –Ω–∞ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å (–¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

### –¢–∞–±–ª–∏—Ü–∞ 3: `rag_index_status`

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (SERIAL PRIMARY KEY)
- `cabinet_id` ‚Äî ID –∫–∞–±–∏–Ω–µ—Ç–∞ (INTEGER, UNIQUE, NOT NULL, INDEX)
- `last_indexed_at` ‚Äî –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ª–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (TIMESTAMP)
- `last_incremental_at` ‚Äî –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (TIMESTAMP)
- `indexing_status` ‚Äî —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (VARCHAR(20)): 'pending', 'in_progress', 'completed', 'failed'
- `total_chunks` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ (INTEGER, DEFAULT 0)
- `created_at` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (TIMESTAMP)
- `updated_at` ‚Äî –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (TIMESTAMP)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL: pgvector

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
- –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pgvector` –≤ PostgreSQL
- –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ: `CREATE EXTENSION IF NOT EXISTS vector;`

**–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:**
- `vector(n)` ‚Äî –≥–¥–µ n ‚Äî —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–∞ (1536 –¥–ª—è OpenAI embeddings)

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞:**
- `<->` ‚Äî L2 distance (–µ–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
- `<#>` ‚Äî cosine distance (–∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
- `<=>` ‚Äî inner product

**–ò–Ω–¥–µ–∫—Å—ã:**
- HNSW (Hierarchical Navigable Small World) ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- IVFFlat ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–π, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤)

### –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

**–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (MVP):**
- OpenAI `text-embedding-3-small` (1536 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: `text-embedding-ada-002` (1536 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å, —É—Å—Ç–∞—Ä–µ–≤—à–∞—è)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1536
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.02 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤ (–¥–ª—è text-embedding-3-small)
- –õ–∏–º–∏—Ç—ã: —Å–æ–≥–ª–∞—Å–Ω–æ OpenAI API limits

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI Embeddings API
- Batch processing –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI Chat Service

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–¥—É–ª—è:**
- `gpt_integration/ai_chat/rag/` ‚Äî –Ω–æ–≤–∞—è –ø–∞–ø–∫–∞ –≤–Ω—É—Ç—Ä–∏ AI Chat —Å–µ—Ä–≤–∏—Å–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è:**
- `rag/__init__.py` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- `rag/query_processor.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `rag/vector_search.py` ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ pgvector
- `rag/context_builder.py` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `rag/prompt_enricher.py` ‚Äî –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
- `rag/models.py` ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏ –¥–ª—è RAG —Ç–∞–±–ª–∏—Ü
- `rag/indexer.py` ‚Äî —Å–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:**
- –í `gpt_integration/ai_chat/app/service.py`:
  - –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ RAG –º–æ–¥—É–ª—è –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–º–ø—Ç–∞
  - –û–±–æ–≥–∞—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ RAG
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å fallback —Å–ª—É—á–∞–∏ (–æ—à–∏–±–∫–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö)

**–õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í—ã–∑–≤–∞—Ç—å RAG –º–æ–¥—É–ª—å: `rag_enrich_prompt(user_message, telegram_id, cabinet_id)`
3. –ü–æ–ª—É—á–∏—Ç—å –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–∏–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π, –µ—Å–ª–∏ RAG –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
4. –ü–µ—Ä–µ–¥–∞—Ç—å –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ `_call_openai()`

### –°–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

**–í–∞—Ä–∏–∞–Ω—Ç 1: Celery Task (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è MVP)**
- –°–æ–∑–¥–∞—Ç—å Celery task –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ
- –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

**–í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å**
- –û—Ç–¥–µ–ª—å–Ω—ã–π Python —Å–∫—Ä–∏–ø—Ç, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π —á–µ—Ä–µ–∑ cron
- –ù–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ü—Ä–æ—â–µ –≤ –æ—Ç–ª–∞–¥–∫–µ

**–í–∞—Ä–∏–∞–Ω—Ç 3: API endpoint**
- –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –í—ã–∑–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è)

**–ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ `rag_index_status`
   - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 'in_progress' ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'in_progress'
   - –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î
   - –°–æ–∑–¥–∞—Ç—å —á–∞–Ω–∫–∏
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'completed'
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'failed', –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- Batch processing —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤ (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Å `updated_at > last_incremental_at`

---

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã (End-to-End)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç–∞**
   - –ü—Ä–∏–º–µ—Ä: "–ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞—é—Ç—Å—è –ª—É—á—à–µ –≤—Å–µ–≥–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é?"

2. **–ë–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç AI Chat Service**
   - `POST /v1/chat/send` —Å `telegram_id` –∏ `message`

3. **AI Chat Service –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `cabinet_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î)

4. **RAG –º–æ–¥—É–ª—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å**
   - **Query Understanding:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂)
   - **Vector Search:** –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –∏–∑ `wb_sales` –∏ `wb_orders`
   - **Context Assembly:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å —Ç–æ–ø-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
   - **Prompt Enrichment:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É

5. **–í—ã–∑–æ–≤ OpenAI API**
   - –û–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ ChatGPT
   - ChatGPT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

6. **–í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
   - –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

1. **–ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)**
   - Celery task –∏–ª–∏ API endpoint

2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞:**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `wb_orders`, `wb_products`, –∏ —Ç.–¥.
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ OpenAI API
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `rag_embeddings` –∏ `rag_metadata`

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `rag_index_status` —Å –¥–∞—Ç–æ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —á–∞–Ω–∫–æ–≤

---

## üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

**–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:**
- –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è: –¥–æ 10,000 —á–∞–Ω–∫–æ–≤ –Ω–∞ –∫–∞–±–∏–Ω–µ—Ç
- –û–±—â–∏–π –æ–±—ä–µ–º: –¥–æ 1,000 –∫–∞–±–∏–Ω–µ—Ç–æ–≤ = –¥–æ 10M —á–∞–Ω–∫–æ–≤

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: < 100ms –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –í—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–∞–±–∏–Ω–µ—Ç–∞: < 5 –º–∏–Ω—É—Ç –¥–ª—è 10,000 —á–∞–Ω–∫–æ–≤

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- OpenAI Embeddings API: ~$0.02 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ 10,000 —á–∞–Ω–∫–æ–≤ (–≤ —Å—Ä–µ–¥–Ω–µ–º 100 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —á–∞–Ω–∫) = 1M —Ç–æ–∫–µ–Ω–æ–≤ = $0.02 –Ω–∞ –∫–∞–±–∏–Ω–µ—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

**1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Wildberries API (FAQ, –ø—Ä–∞–≤–∏–ª–∞)
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –í–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ (—Ü–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, —Ç—Ä–µ–Ω–¥—ã)

**2. –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞:**
- Re-ranking —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è)
- Hybrid search (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏ keyword –ø–æ–∏—Å–∫–∞)
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, —Å—Ç–∞—Ç—É—Å–∞–º

**3. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–ª—å—Ç—Ä—ã:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤ `rag_metadata`:
  - `date_range` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞–Ω–Ω—ã—Ö
  - `category` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
  - `status` ‚Äî —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞/–ø—Ä–æ–¥–∞–∂–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º

**4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞

**5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- –ú–µ—Ç—Ä–∏–∫–∏: –∫–∞–∫–∏–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —á–∞—â–µ –≤—Å–µ–≥–æ, –∫–∞–∫–∏–µ —á–∞–Ω–∫–∏ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–æ–∏—Å–∫–∞

**6. –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å (–±—É–¥—É—â–µ–µ):**
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤
- –ü–æ–∏—Å–∫ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º (image embeddings)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- `OPENAI_EMBEDDINGS_MODEL` ‚Äî –º–æ–¥–µ–ª—å –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (default: "text-embedding-3-small")
- `RAG_VECTOR_DB_URL` ‚Äî URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Å pgvector (–º–æ–∂–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- `RAG_ENABLED` ‚Äî –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å RAG (default: true)
- `RAG_MAX_CHUNKS` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (default: 5)
- `RAG_SIMILARITY_THRESHOLD` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (default: 0.7)
- `RAG_CONTEXT_MAX_LENGTH` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (default: 3000)
- `RAG_INDEXING_INTERVAL_HOURS` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —á–∞—Å–∞—Ö (default: 6)
- `RAG_EMBEDDING_BATCH_SIZE` ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (default: 100)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `cabinet_id`
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è `cabinet_id` –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–æ–∏—Å–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ `cabinet_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–µ—Ä–µ–¥ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ `cabinet_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å `cabinet_id`

### –ó–∞—â–∏—Ç–∞ API

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ä—ã:**
- API –∫–ª—é—á –¥–ª—è AI Chat Service (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
- Rate limiting (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞)

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ MVP

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

- **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** > 80% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–æ–ø-5
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –≤—Ä–µ–º—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ < 100ms
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö:** > 90% –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** < 1% –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–µ

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

- **–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- **–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
- **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI-—á–∞—Ç–∞:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—â–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### MVP (Must Have)

- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (orders, products, stocks, reviews, sales)
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ cabinet_id
- ‚úÖ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º AI Chat Service
- ‚úÖ Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### Nice to Have (–±—É–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏)

- Query Understanding —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM
- Re-ranking —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- Hybrid search (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + keyword)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è RAG
- –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–æ–µ –¢–ó –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω RAG-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è MVP —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π AI Chat Service –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pgvector –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ú–∏–Ω–∏–º–∞–ª–∏–∑–º: —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è MVP
- –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ò–∑–æ–ª—è—Ü–∏—è: —Å—Ç—Ä–æ–≥–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¢–ó
2. –ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≠—Ç–∞–ø–∞ 1 (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** Technical Specification  
**–§–æ—Ä–º–∞—Ç:** –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ –¢–ó –±–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞

