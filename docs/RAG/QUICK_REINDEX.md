# üöÄ –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è RAG

## –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —á–µ—Ä–µ–∑ API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è cabinet_id=1
curl -X POST \
  http://localhost:9000/v1/rag/index/1 \
  -H "X-API-KEY: ${API_SECRET_KEY}"
```

–ó–∞–º–µ–Ω–∏—Ç–µ `${API_SECRET_KEY}` –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –≤–∞—à–µ–≥–æ `.env` —Ñ–∞–π–ª–∞.

---

## –í–∞—Ä–∏–∞–Ω—Ç 2: –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

```bash
# 1. –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose exec gpt python -m gpt_integration.ai_chat.RAG.reset_index_status 1

# 2. –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)
# –ò–õ–ò –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é (–í–∞—Ä–∏–∞–Ω—Ç 1)
```

---

## –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Celery (–≤—Å–µ –∫–∞–±–∏–Ω–µ—Ç—ã —Å—Ä–∞–∑—É)

```bash
docker-compose exec server python << 'EOF'
from app.features.rag.tasks import index_all_cabinets_rag
result = index_all_cabinets_rag()
print(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
EOF
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ß–µ—Ä–µ–∑ API
curl -X GET \
  http://localhost:9000/v1/rag/status/1 \
  -H "X-API-KEY: ${API_SECRET_KEY}"

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
# {
#   "status": "success",
#   "indexing_status": "completed",
#   "total_chunks": 2250,
#   "last_indexed_at": "2025-12-16T15:30:00"
# }
```

---

## –õ–æ–≥–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

```bash
# –õ–æ–≥–∏ AI-—Å–µ—Ä–≤–∏—Å–∞ (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)
docker-compose logs -f gpt | grep "RAG"

# –õ–æ–≥–∏ Celery Worker (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ Celery)
docker-compose logs -f celery-worker | grep "rag"
```

---

## –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ AI-—Å–µ—Ä–≤–∏—Å:
   ```bash
   docker-compose restart gpt
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∏—Å–∫:
   - –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –±–æ—Ç—É: "–ö–∞–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å?"
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ similarity scores:
     ```bash
     docker-compose logs -f gpt | grep "similarity="
     ```

3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   - Chunk types: **stock** (–≤–º–µ—Å—Ç–æ review, sale)
   - Similarity: **0.3 - 1.0** (–≤–º–µ—Å—Ç–æ > 1.0)
   - –û—Ç–≤–µ—Ç: —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏

---

**–î–∞—Ç–∞**: 2025-12-16
