# üö® S2 ISSUE: –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –¥–∞–Ω–Ω—ã—Ö WB API

## üéØ –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

**WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–∞—à –∫–æ–¥ –∏—Ö –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢!**

### üìä –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç WB API

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ `https://statistics-api.wildberries.ru/api/v1/supplier/orders` WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫–∞–∑–∞:

```json
{
  "date": "2025-09-05T21:58:08",
  "lastChangeDate": "2025-09-06T00:21:11",
  "warehouseName": "–¢—É–ª–∞",                    // ‚úÖ –ï–°–¢–¨! –°–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  "warehouseType": "–°–∫–ª–∞–¥ WB",
  "countryName": "–†–æ—Å—Å–∏—è",
  "oblastOkrugName": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥",
  "regionName": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",         // ‚úÖ –ï–°–¢–¨! –†–µ–≥–∏–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏
  "supplierArticle": "slavabrand_blouse_chiffon_white",
  "nmId": 255366800,
  "barcode": "2041002704600",
  "category": "–û–¥–µ–∂–¥–∞",                       // ‚úÖ –ï–°–¢–¨! –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
  "subject": "–ë–ª—É–∑–∫–∏",                        // ‚úÖ –ï–°–¢–¨! –ü—Ä–µ–¥–º–µ—Ç —Ç–æ–≤–∞—Ä–∞
  "brand": "SLAVALOOK BRAND",
  "techSize": "S",
  "incomeID": 30272851,
  "isSupply": false,
  "isRealization": true,
  "totalPrice": 3000,                         // ‚úÖ –ï–°–¢–¨! –¶–µ–Ω–∞ –∑–∞–∫–∞–∑–∞
  "discountPercent": 60,                      // ‚úÖ –ï–°–¢–¨! –°–∫–∏–¥–∫–∞
  "spp": 36,                                  // ‚úÖ –ï–°–¢–¨! –°–ü–ü –ø—Ä–æ—Ü–µ–Ω—Ç
  "finishedPrice": 768,                       // ‚úÖ –ï–°–¢–¨! –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
  "priceWithDisc": 1200,                      // ‚úÖ –ï–°–¢–¨! –¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π
  "isCancel": false,
  "cancelDate": "0001-01-01T00:00:00",
  "sticker": "35572238989",
  "gNumber": "91388477343660116602",
  "srid": "17911162113526944.0.0"
}
```

### ‚ùå –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –±–æ—Ç–µ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

```json
{
  "id": 14807,
  "date": "2025-09-07T21:12:32+00:00",
  "amount": 3000.0,
  "product_name": "–ë–ª—É–∑–∫–∏",
  "brand": "SLAVALOOK BRAND",
  "warehouse_from": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",             // ‚ùå –ó–ê–ì–õ–£–®–ö–ê!
  "warehouse_to": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",               // ‚ùå –ó–ê–ì–õ–£–®–ö–ê!
  "commission_percent": 20.0,                 // ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
  "rating": 0.0,                              // ‚ùå –ó–ê–ì–õ–£–®–ö–ê!
  "order_amount": 0,                          // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
  "spp_percent": 0,                           // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
  "customer_price": 0,                        // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
  "logistics_amount": 0.0                     // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
}
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ü–æ–ª—è —Å–∫–ª–∞–¥–æ–≤** - `warehouse_from` –∏ `warehouse_to`
- **WB API –¥–∞–µ—Ç:** `warehouseName: "–¢—É–ª–∞"`, `regionName: "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"`
- **–ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** `"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"` (–∑–∞–≥–ª—É—à–∫–∏ –≤ –∫–æ–¥–µ)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í `bot_api/service.py` —Å—Ç—Ä–æ–∫–∏ 155-156 –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∏

### 2. **–¶–µ–Ω—ã –∏ –°–ü–ü** - `order_amount`, `spp_percent`, `customer_price`
- **WB API –¥–∞–µ—Ç:** `totalPrice: 3000`, `spp: 36`, `finishedPrice: 768`
- **–ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** `0` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í `sync_service.py` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π

### 3. **–õ–æ–≥–∏—Å—Ç–∏–∫–∞** - `logistics_amount`
- **WB API –¥–∞–µ—Ç:** –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
- **–ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** `0.0` (–Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º

### 4. **–†–µ–π—Ç–∏–Ω–≥–∏** - `rating`
- **WB API –¥–∞–µ—Ç:** –ù–µ—Ç –≤ –∑–∞–∫–∞–∑–∞—Ö (–Ω—É–∂–Ω–æ –∏–∑ –æ—Ç–∑—ã–≤–æ–≤)
- **–ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** `0.0` (–∑–∞–≥–ª—É—à–∫–∞)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏–∑ API –æ—Ç–∑—ã–≤–æ–≤

## üéØ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã

### **–í `sync_service.py`:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ —Ç–µ –ø–æ–ª—è –∏–∑ WB API
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏** - –Ω–µ—Ç –ø–æ–ª–µ–π –¥–ª—è —Å–∫–ª–∞–¥–æ–≤, –°–ü–ü, –ª–æ–≥–∏—Å—Ç–∏–∫–∏
3. **–ó–∞–≥–ª—É—à–∫–∏ –≤ Bot API** - –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"

### **–í `bot_api/service.py`:**
1. **–ó–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - —Å—Ç—Ä–æ–∫–∏ 155-156
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è** - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ —Ç–µ –ø–æ–ª—è –∏–∑ –ë–î
3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞** - –Ω–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏, –°–ü–ü

## üöÄ –†–µ—à–µ–Ω–∏–µ

### **1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å WBOrder:**
```python
# –ü–æ–ª—è —Å–∫–ª–∞–¥–æ–≤
warehouse_from = Column(String(255), nullable=True)      # warehouseName
warehouse_to = Column(String(255), nullable=True)         # regionName
# –ü–æ–ª—è —Ü–µ–Ω –∏ –°–ü–ü
order_amount = Column(Float, nullable=True)              # totalPrice
spp_percent = Column(Float, nullable=True)                # spp
customer_price = Column(Float, nullable=True)             # finishedPrice
discount_percent = Column(Float, nullable=True)           # discountPercent
# –ü–æ–ª—è –ª–æ–≥–∏—Å—Ç–∏–∫–∏
logistics_amount = Column(Float, nullable=True)           # —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
```

### **2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ sync_service.py:**
```python
# –í–º–µ—Å—Ç–æ:
existing.price = order_data.get("finishedPrice")
existing.total_price = order_data.get("totalPrice")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
existing.order_amount = order_data.get("totalPrice")
existing.spp_percent = order_data.get("spp")
existing.customer_price = order_data.get("finishedPrice")
existing.warehouse_from = order_data.get("warehouseName")
existing.warehouse_to = order_data.get("regionName")
```

### **3. –£–±—Ä–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –≤ bot_api/service.py:**
```python
# –í–º–µ—Å—Ç–æ:
"warehouse_from": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
"warehouse_to": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
"warehouse_from": order.warehouse_from or "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
"warehouse_to": order.warehouse_to or "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
```

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **–≠—Ç–∞–ø 1: –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ WBOrder –º–æ–¥–µ–ª—å
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã

### **–≠—Ç–∞–ø 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –≤ sync_service.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –ª–æ–≥–∏—Å—Ç–∏–∫–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### **–≠—Ç–∞–ø 3: Bot API**
- [ ] –£–±—Ä–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –≤ bot_api/service.py
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ –ë–î
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### **–≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–æ—Ç–µ
- [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ª—è

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±–æ—Ç–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:

```json
{
  "id": 14807,
  "date": "2025-09-07T21:12:32+00:00",
  "amount": 3000.0,
  "product_name": "–ë–ª—É–∑–∫–∏",
  "brand": "SLAVALOOK BRAND",
  "warehouse_from": "–¢—É–ª–∞",                    // ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
  "warehouse_to": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",       // ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
  "commission_percent": 20.0,                 // ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
  "order_amount": 3000,                       // ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
  "spp_percent": 36,                          // ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
  "customer_price": 768,                      // ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
  "logistics_amount": 161.5,                  // ‚úÖ –†–ê–°–°–ß–ò–¢–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï!
  "rating": 4.8                               // ‚úÖ –ò–ó –û–¢–ó–´–í–û–í!
}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### **–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `server/app/features/wb_api/models.py` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è
2. `server/app/features/wb_api/sync_service.py` - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥
3. `server/app/features/bot_api/service.py` - —É–±—Ä–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏
4. `server/app/features/bot_api/formatter.py` - –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ü–æ–ª—è WB API ‚Üí –ù–∞—à–∏ –ø–æ–ª—è:**
- `warehouseName` ‚Üí `warehouse_from`
- `regionName` ‚Üí `warehouse_to`
- `totalPrice` ‚Üí `order_amount`
- `spp` ‚Üí `spp_percent`
- `finishedPrice` ‚Üí `customer_price`
- `discountPercent` ‚Üí `discount_percent`

### **–†–∞—Å—á–µ—Ç–Ω—ã–µ –ø–æ–ª—è:**
- `logistics_amount` - –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º —Å–∫–ª–∞–¥–∞
- `rating` - –∏–∑ API –æ—Ç–∑—ã–≤–æ–≤
- `reviews_count` - –∏–∑ API –æ—Ç–∑—ã–≤–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –í–´–°–û–ö–ò–ô - –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø - —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ 4 —Ñ–∞–π–ª–∞—Ö
