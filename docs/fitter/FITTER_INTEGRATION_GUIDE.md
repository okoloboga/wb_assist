# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∏–º–µ—Ä–∫–∏ (Fitter) - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ö–û–ü–ò–†–û–í–ê–ù–ò–Æ –∫–æ–¥–∞

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ü–†–û–ß–ò–¢–ê–ô –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –†–ê–ë–û–¢–´

**–≠—Ç–æ –∑–∞–¥–∞—á–∞ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –≥–æ—Ç–æ–≤–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –∫–æ–¥–∞, –∞ –ù–ï —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω—É–ª—è.**

–í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±–æ—Ç–∞-–¥–æ–Ω–æ—Ä–∞ –ø–æ –ø—É—Ç–∏ `fitting_bot/`.
–í–µ—Å—å –∫–æ–¥ –ø—Ä–∏–º–µ—Ä–∫–∏ —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

1. **–ü–†–û–ß–ò–¢–ê–¢–¨** –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ `fitting_bot/`
2. **–°–ö–û–ü–ò–†–û–í–ê–¢–¨** –∏—Ö –≤ —Ü–µ–ª–µ–≤—É—é –ø–∞–ø–∫—É `gpt_integration/fitter/`
3. **–ò–°–ü–†–ê–í–ò–¢–¨ –¢–û–õ–¨–ö–û –ò–ú–ü–û–†–¢–´** –≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
4. **–î–û–ë–ê–í–ò–¢–¨ endpoint** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `gpt_integration/service.py`

**–ù–ï –ü–ò–®–ò –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ–º–ø—Ç–æ–≤, –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ. –û–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.**

---

## –®–∞–≥ 0: –ü—Ä–æ—á–∏—Ç–∞–π –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

–ü–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ—á–∏—Ç–∞–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–æ–Ω–æ—Ä–∞:

| # | –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª (–î–û–ù–û–†) | –ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç |
|---|---|---|
| 1 | `fitting_bot/gpt_integration/photo_processing/prompts.py` | –ü—Ä–æ–º–ø—Ç—ã TRYON_SINGLE_ITEM, TRYON_FULL_OUTFIT, VALIDATION_PROMPT |
| 2 | `fitting_bot/gpt_integration/photo_processing/image_client.py` | –ö–ª–∞—Å—Å ImageGenerationClient —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Gemini + GPT Image –º–æ–¥–µ–ª–µ–π |
| 3 | `fitting_bot/gpt_integration/photo_processing/validator.py` | –§—É–Ω–∫—Ü–∏—è validate_photo() - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ ChatGPT |
| 4 | `fitting_bot/gpt_integration/photo_processing/generator.py` | –§—É–Ω–∫—Ü–∏—è generate_tryon() - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–∫–∏ |

–¢–∞–∫–∂–µ –ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª—ã —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

| # | –¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª (–ü–†–û–ï–ö–¢) | –ó–∞—á–µ–º —á–∏—Ç–∞—Ç—å |
|---|---|---|
| 1 | `gpt_integration/service.py` | FastAPI app - —Å—é–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π endpoint |
| 2 | `gpt_integration/gpt_client.py` | GPTClient —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ validator.py |
| 3 | `gpt_integration/photo_processing/image_client.py` | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π ImageGenerationClient - –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –∏–∑ –¥–æ–Ω–æ—Ä–∞ |

---

## –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `gpt_integration/fitter/`

```bash
mkdir -p gpt_integration/fitter
```

---

## –®–∞–≥ 2: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å 4 —Ñ–∞–π–ª–∞ –∏–∑ –¥–æ–Ω–æ—Ä–∞

### 2.1 prompts.py - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô

**–û—Ç–∫—É–¥–∞:** `fitting_bot/gpt_integration/photo_processing/prompts.py`
**–ö—É–¥–∞:** `gpt_integration/fitter/prompts.py`

–§–∞–π–ª –Ω–µ –∏–º–µ–µ—Ç –∏–º–ø–æ—Ä—Ç–æ–≤ - –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è as-is, –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –Ω—É–∂–Ω–æ.

### 2.2 image_client.py - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô

**–û—Ç–∫—É–¥–∞:** `fitting_bot/gpt_integration/photo_processing/image_client.py`
**–ö—É–¥–∞:** `gpt_integration/fitter/image_client.py`

–§–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏ pip-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (httpx, PIL, tenacity) - –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è as-is.

**–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ—Ç —Ñ–∞–π–ª –ù–ï —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π, —á—Ç–æ `gpt_integration/photo_processing/image_client.py`.
–í–µ—Ä—Å–∏—è –∏–∑ –¥–æ–Ω–æ—Ä–∞ - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GPT Image –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ multipart/form-data, –∑–∞–≥—Ä—É–∑–∫—É –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –∏ –º–µ—Ç–æ–¥ `process_images()` (–≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —á–∏—Å–ª–µ). –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –≤ `photo_processing/` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ Gemini –∏ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `process_image()` (–≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º —á–∏—Å–ª–µ). –≠—Ç–æ –†–ê–ó–ù–´–ï —Ñ–∞–π–ª—ã, –æ–Ω–∏ –ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç - –Ω–æ–≤—ã–π –∫–ª–∞–¥—ë—Ç—Å—è –≤ `fitter/`, —Å—Ç–∞—Ä—ã–π –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `photo_processing/`.

### 2.3 generator.py - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –ò–°–ü–†–ê–í–ò–¢–¨ 2 –ò–ú–ü–û–†–¢–ê

**–û—Ç–∫—É–¥–∞:** `fitting_bot/gpt_integration/photo_processing/generator.py`
**–ö—É–¥–∞:** `gpt_integration/fitter/generator.py`

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ–Ω–∏—Ç—å —Ä–æ–≤–Ω–æ 2 —Å—Ç—Ä–æ–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞:

```python
# –ë–´–õ–û (–≤ –¥–æ–Ω–æ—Ä–µ):
from gpt_integration.photo_processing.image_client import ImageGenerationClient
from gpt_integration.photo_processing.prompts import (
    TRYON_SINGLE_ITEM,
    TRYON_FULL_OUTFIT,
)

# –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê:
from .image_client import ImageGenerationClient
from .prompts import (
    TRYON_SINGLE_ITEM,
    TRYON_FULL_OUTFIT,
)
```

**–ë–æ–ª—å—à–µ –ù–ò–ß–ï–ì–û –≤ —Ñ–∞–π–ª–µ –Ω–µ –º–µ–Ω—è—Ç—å.** –í—Å—è –ª–æ–≥–∏–∫–∞ generate_tryon() –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### 2.4 validator.py - –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –ò–°–ü–†–ê–í–ò–¢–¨ 1 –ò–ú–ü–û–†–¢

**–û—Ç–∫—É–¥–∞:** `fitting_bot/gpt_integration/photo_processing/validator.py`
**–ö—É–¥–∞:** `gpt_integration/fitter/validator.py`

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ–Ω–∏—Ç—å 1 —Å—Ç—Ä–æ–∫—É –∏–º–ø–æ—Ä—Ç–∞:

```python
# –ë–´–õ–û (–≤ –¥–æ–Ω–æ—Ä–µ):
from gpt_integration.gpt_client import GPTClient

# –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê:
from gpt_integration.gpt_client import GPTClient
```

**–í–ê–ñ–ù–û –æ GPTClient:** –í –¥–æ–Ω–æ—Ä–µ –∏ –≤ —Ü–µ–ª–µ–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∫–ª–∞—Å—Å—ã GPTClient –†–ê–ó–ù–´–ï –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –∏–º–µ—é—Ç –û–î–ò–ù–ê–ö–û–í–´–ô –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –º–µ—Ç–æ–¥ `async complete_messages(messages) -> str`. –ü–æ—ç—Ç–æ–º—É –∏–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–º –∂–µ –ø—É—Ç—ë–º (`gpt_integration.gpt_client`), –Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è GPTClient —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ç.–∫. API —Å–æ–≤–ø–∞–¥–∞–µ—Ç.

---

## –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å `__init__.py` (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ù–û–í–´–ô —Ñ–∞–π–ª)

**–§–∞–π–ª:** `gpt_integration/fitter/__init__.py`

```python
"""
–ú–æ–¥—É–ª—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø—Ä–∏–º–µ—Ä–∫–∏ –æ–¥–µ–∂–¥—ã (Fitter).
–ö–æ–¥ –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –∏–∑ fitting_bot/gpt_integration/photo_processing/.
"""
from .generator import generate_tryon
from .validator import validate_photo
```

–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å –Ω—É–ª—è. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 2 –∏–º–ø–æ—Ä—Ç–∞.

---

## –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å endpoint –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π service.py

**–§–∞–π–ª:** `gpt_integration/service.py`

–î–æ–±–∞–≤–∏—Ç—å Pydantic-–º–æ–¥–µ–ª—å –∏ endpoint –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª. –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤.

### 4.1 –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –∑–∞–ø—Ä–æ—Å–∞ (—Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏, –ø–æ—Å–ª–µ –∫–ª–∞—Å—Å–∞ SemanticCoreRequest):

```python
class TryOnRequest(BaseModel):
    user_photo_url: str
    product_photo_urls: List[str]
    model: str = "gemini-2.5-flash-image"
    mode: str = "single_item"
    item_name: str = "–æ–¥–µ–∂–¥–∞"
    category: str = "–æ–¥–µ–∂–¥–∞"
```

### 4.2 –î–æ–±–∞–≤–∏—Ç—å endpoint (–≤ —Å–µ–∫—Ü–∏—é –ø–æ—Å–ª–µ Semantic Core Endpoints):

```python
# ============================================================================
# Fitter / Try-On Endpoints
# ============================================================================

@app.post("/v1/fitter/try-on")
async def fitter_try_on(
    req: TryOnRequest,
    x_api_key: Optional[str] = Header(None)
) -> Dict[str, Any]:
    """–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–∫–∞ –æ–¥–µ–∂–¥—ã."""
    expected_key = os.getenv("API_SECRET_KEY", "")
    if not x_api_key or x_api_key != expected_key:
        raise HTTPException(status_code=403, detail="Invalid or missing API key")

    from gpt_integration.fitter import generate_tryon

    result = await generate_tryon(
        user_photo_source=req.user_photo_url,
        product_photo_sources=req.product_photo_urls,
        api_key=os.getenv("COMET_API_KEY"),
        base_url=os.getenv("IMAGE_GEN_BASE_URL", "https://api.cometapi.com"),
        model=req.model,
        tryon_mode=req.mode,
        item_name=req.item_name,
        category=req.category
    )

    return result
```

---

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ `gpt_integration/requirements.txt` –µ—Å—Ç—å:

```
httpx
Pillow
tenacity
```

–≠—Ç–∏ –ø–∞–∫–µ—Ç—ã —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (httpx –∏ Pillow –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º photo_processing). –ü—Ä–æ–≤–µ—Ä—å –∏ –¥–æ–±–∞–≤—å —Ç–æ–ª—å–∫–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ.

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
gpt_integration/
‚îú‚îÄ‚îÄ fitter/                          # –ù–û–í–ê–Ø –ü–ê–ü–ö–ê
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                  # –ù–∞–ø–∏—Å–∞—Ç—å (3 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ generator.py                 # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞, –ø–æ–ø—Ä–∞–≤–∏—Ç—å 2 –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ image_client.py              # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îÇ   ‚îú‚îÄ‚îÄ prompts.py                   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îÇ   ‚îî‚îÄ‚îÄ validator.py                 # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å 1 –∏–º–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ photo_processing/                # –ù–ï –¢–†–û–ì–ê–¢–¨ - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ image_client.py              # –°—Ç–∞—Ä—ã–π –∫–ª–∏–µ–Ω—Ç (—Ç–æ–ª—å–∫–æ Gemini) - –æ—Å—Ç–∞–≤–∏—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ service.py                   # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å - –æ—Å—Ç–∞–≤–∏—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ gpt_client.py                    # –ù–ï –¢–†–û–ì–ê–¢–¨ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è validator.py
‚îú‚îÄ‚îÄ comet_client.py                  # –ù–ï –¢–†–û–ì–ê–¢–¨
‚îî‚îÄ‚îÄ service.py                       # –ò–ó–ú–ï–ù–ò–¢–¨ - –¥–æ–±–∞–≤–∏—Ç—å TryOnRequest + endpoint
```

---

## –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω—ã –≤—Å–µ 4 –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–∞ –∏–∑ `fitting_bot/gpt_integration/photo_processing/`
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `gpt_integration/fitter/`
- [ ] `prompts.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] `image_client.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] `generator.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
- [ ] `validator.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏–º–ø–æ—Ä—Ç GPTClient
- [ ] –°–æ–∑–¥–∞–Ω `__init__.py` —Å 2 –∏–º–ø–æ—Ä—Ç–∞–º–∏
- [ ] –í `service.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å TryOnRequest
- [ ] –í `service.py` –¥–æ–±–∞–≤–ª–µ–Ω endpoint `/v1/fitter/try-on`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt

---

## –®–∞–≥ 6: –ü–µ—Ä–µ–Ω–æ—Å —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### 6.1 –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ö—ç–Ω–¥–ª–µ—Ä—ã –ø—Ä–∏–º–µ—Ä–∫–∏

**–û—Ç–∫—É–¥–∞:** `fitting_bot/bot/handlers/fitter.py`
**–ö—É–¥–∞:** `bot/handlers/fitter.py`

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã:

```python
# –ë–´–õ–û (–≤ –¥–æ–Ω–æ—Ä–µ):
from gpt_integration.photo_processing.generator import generate_tryon
from gpt_integration.photo_processing.validator import validate_photo

# –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê:
from gpt_integration.fitter import generate_tryon, validate_photo
```

–û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã (aiogram, keyboards, utils) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### 6.2 –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏–º–µ—Ä–∫–∏

**–û—Ç–∫—É–¥–∞:** `fitting_bot/bot/keyboards/fitter_keyboards.py`
**–ö—É–¥–∞:** `bot/keyboards/fitter_keyboards.py`

–§–∞–π–ª –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π - —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ aiogram InlineKeyboardMarkup –∏ InlineKeyboardButton.

### 6.3 –û–±–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–ª–∞–≤–∏–∞—Ç—É—Ä

**–§–∞–π–ª:** `bot/keyboards/keyboards.py`

–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä –ø—Ä–∏–º–µ—Ä–∫–∏:

```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é –∏–º–ø–æ—Ä—Ç–æ–≤:
from .fitter_keyboards import (
    get_fitter_main_menu,
    get_fitter_mode_selection,
    get_fitter_category_selection,
    get_fitter_back_to_main
)

# –î–æ–±–∞–≤–∏—Ç—å –≤ __all__ (–µ—Å–ª–∏ –µ—Å—Ç—å):
__all__ = [
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
    "get_fitter_main_menu",
    "get_fitter_mode_selection", 
    "get_fitter_category_selection",
    "get_fitter_back_to_main"
]
```

---

## –®–∞–≥ 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–ø–æ–º–æ—â–Ω–∏–∫–æ–º

### 7.1 –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–æ–¥–µ–≤–∞–ª–∫–∞" –≤ AI-–ø–æ–º–æ—â–Ω–∏–∫

**–§–∞–π–ª:** `bot/keyboards/keyboards.py`

–ù–∞–π—Ç–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É AI-–ø–æ–º–æ—â–Ω–∏–∫–∞ –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏–º–µ—Ä–∫–∏:

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã AI-–ø–æ–º–æ—â–Ω–∏–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å:
InlineKeyboardButton("üëó –ü–µ—Ä–µ–æ–¥–µ–≤–∞–ª–∫–∞", callback_data="ai_fitter")
```

### 7.2 –°–æ–∑–¥–∞—Ç—å —Ö—ç–Ω–¥–ª–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø—Ä–∏–º–µ—Ä–∫–µ –∏–∑ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞

**–§–∞–π–ª:** `bot/handlers/ai_chat.py` (–∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª AI-–ø–æ–º–æ—â–Ω–∏–∫–∞)

–î–æ–±–∞–≤–∏—Ç—å callback handler:

```python
@router.callback_query(F.data == "ai_fitter")
async def ai_fitter_transition(callback: CallbackQuery):
    """–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –ø—Ä–∏–º–µ—Ä–∫–∏ –∏–∑ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞."""
    from bot.keyboards.fitter_keyboards import get_fitter_main_menu
    
    await callback.message.edit_text(
        "üëó <b>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–∫–∞ –æ–¥–µ–∂–¥—ã</b>\n\n"
        "–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—ë —Ñ–æ—Ç–æ –∏ —Ñ–æ—Ç–æ –æ–¥–µ–∂–¥—ã, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–∏—Ç—å. "
        "–Ø —Å–æ–∑–¥–∞–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –±—É–¥–µ—Ç–µ –≤—ã–≥–ª—è–¥–µ—Ç—å –≤ —ç—Ç–æ–π –æ–¥–µ–∂–¥–µ.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=get_fitter_main_menu(),
        parse_mode="HTML"
    )
    await callback.answer()
```

### 7.3 –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

**–§–∞–π–ª:** `bot/__main__.py`

–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –ø—Ä–∏–º–µ—Ä–∫–∏:

```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é –∏–º–ø–æ—Ä—Ç–æ–≤:
from bot.handlers import fitter

# –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–æ–≤:
dp.include_router(fitter.router)
```

---

## –®–∞–≥ 8: –°–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FSM)

**–§–∞–π–ª:** `bot/states/fitter_states.py`

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞:

**–û—Ç–∫—É–¥–∞:** `fitting_bot/bot/states/fitter_states.py`
**–ö—É–¥–∞:** `bot/states/fitter_states.py`

–§–∞–π–ª –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π - —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ aiogram StatesGroup –∏ State.

---

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

### Backend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω—ã –≤—Å–µ 4 –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–∞ –∏–∑ `fitting_bot/gpt_integration/photo_processing/`
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `gpt_integration/fitter/`
- [ ] `prompts.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] `image_client.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] `generator.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
- [ ] `validator.py` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏–º–ø–æ—Ä—Ç GPTClient
- [ ] –°–æ–∑–¥–∞–Ω `__init__.py` —Å 2 –∏–º–ø–æ—Ä—Ç–∞–º–∏
- [ ] –í `service.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å TryOnRequest
- [ ] –í `service.py` –¥–æ–±–∞–≤–ª–µ–Ω endpoint `/v1/fitter/try-on`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt

### Bot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω `bot/handlers/fitter.py` —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω `bot/keyboards/fitter_keyboards.py` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω `bot/states/fitter_states.py` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `bot/keyboards/keyboards.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–æ–¥–µ–≤–∞–ª–∫–∞" –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É AI-–ø–æ–º–æ—â–Ω–∏–∫–∞
- [ ] –°–æ–∑–¥–∞–Ω callback handler –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø—Ä–∏–º–µ—Ä–∫–µ –∏–∑ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `bot/__main__.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞ –ø—Ä–∏–º–µ—Ä–∫–∏

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
gpt_integration/
‚îú‚îÄ‚îÄ fitter/                          # –ù–û–í–ê–Ø –ü–ê–ü–ö–ê - backend
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                  # –ù–∞–ø–∏—Å–∞—Ç—å (3 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ generator.py                 # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞, –ø–æ–ø—Ä–∞–≤–∏—Ç—å 2 –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ image_client.py              # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îÇ   ‚îú‚îÄ‚îÄ prompts.py                   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îÇ   ‚îî‚îÄ‚îÄ validator.py                 # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å 1 –∏–º–ø–æ—Ä—Ç
‚îî‚îÄ‚îÄ service.py                       # –ò–ó–ú–ï–ù–ò–¢–¨ - –¥–æ–±–∞–≤–∏—Ç—å TryOnRequest + endpoint

bot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ fitter.py                    # –ù–û–í–´–ô - —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞, –ø–æ–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ ai_chat.py                   # –ò–ó–ú–ï–ù–ò–¢–¨ - –¥–æ–±–∞–≤–∏—Ç—å callback handler
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ fitter_keyboards.py          # –ù–û–í–´–ô - —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.py                 # –ò–ó–ú–ï–ù–ò–¢–¨ - –¥–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏ –∫–Ω–æ–ø–∫—É –≤ AI-–ø–æ–º–æ—â–Ω–∏–∫
‚îú‚îÄ‚îÄ states/
‚îÇ   ‚îî‚îÄ‚îÄ fitter_states.py             # –ù–û–í–´–ô - —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –¥–æ–Ω–æ—Ä–∞ as-is
‚îî‚îÄ‚îÄ __main__.py                      # –ò–ó–ú–ï–ù–ò–¢–¨ - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –ø—Ä–∏–º–µ—Ä–∫–∏
```

---

## –ß–µ–≥–æ –ù–ï –ù–£–ñ–ù–û –¥–µ–ª–∞—Ç—å

- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π FastAPI —Ä–æ—É—Ç–µ—Ä (router.py) - endpoint –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ service.py –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å service.py –≤–Ω—É—Ç—Ä–∏ fitter/ - —Ñ—É–Ω–∫—Ü–∏—è generate_tryon() –∏–∑ generator.py —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å exceptions.py - generator.py —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict —Å success/error
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å models.py –≤–Ω—É—Ç—Ä–∏ fitter/ - –æ–¥–Ω–∞ Pydantic-–º–æ–¥–µ–ª—å TryOnRequest –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π service.py
- –ù–ï —Ç—Ä–æ–≥–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π photo_processing/ - —ç—Ç–æ –¥—Ä—É–≥–æ–π –º–æ–¥—É–ª—å –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç—ã —Å API - –æ–Ω–∞ —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–ï –º–µ–Ω—è—Ç—å GPTClient –∏–ª–∏ CometClient - validator.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π GPTClient —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ middleware –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞
- –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã - –æ–Ω–∏ —É–∂–µ –≥–æ—Ç–æ–≤—ã –≤ –¥–æ–Ω–æ—Ä–µ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
