# ‚úÖ –≠—Ç–∞–ø 4: Telegram Bot UI - –ó–∞–≤–µ—Ä—à–µ–Ω

–î–∞—Ç–∞: 09.02.2026

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
**–§–∞–π–ª:** `bot/keyboards/keyboards.py`

**–ù–æ–≤—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:**

#### get_settings_keyboard()
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –≤—ã–±–æ—Ä–∞ AI –º–æ–¥–µ–ª–∏:
```python
[ü§ñ –í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏]
[üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
[üîë API –∫–ª—é—á WB]
[‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

#### get_ai_model_selection_keyboard(current_model)
–í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏ —Å –æ—Ç–º–µ—Ç–∫–æ–π —Ç–µ–∫—É—â–µ–π:
```python
[‚úÖ GPT-4o Mini]  # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞
[Claude Sonnet 3.5]
[‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º]
```

### 2. –°–æ–∑–¥–∞–Ω handler –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–§–∞–π–ª:** `bot/handlers/settings.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ callbacks:**

#### /settings
–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### Callback handlers:
- `settings` - –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `settings_ai_model` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏
- `ai_model_gpt-4o-mini` - –≤—ã–±—Ä–∞—Ç—å GPT-4o Mini
- `ai_model_claude-sonnet-3.5` - –≤—ã–±—Ä–∞—Ç—å Claude Sonnet 3.5

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ (‚úÖ)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

### 3. –û–±–Ω–æ–≤–ª–µ–Ω API –∫–ª–∏–µ–Ω—Ç
**–§–∞–π–ª:** `bot/api/client.py`

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

#### get_available_ai_models()
```python
async def get_available_ai_models(self) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö AI –º–æ–¥–µ–ª–µ–π"""
```

#### get_user_settings(telegram_id)
```python
async def get_user_settings(self, telegram_id: int) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
```

#### update_user_settings(telegram_id, preferred_ai_model)
```python
async def update_user_settings(
    self,
    telegram_id: int,
    preferred_ai_model: Optional[str] = None
) -> Dict[str, Any]:
    """–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
```

### 4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω router
**–§–∞–π–ª:** `bot/__main__.py`

- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `settings_router`
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ dispatcher

## üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /settings
–ë–æ—Ç: ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
     [ü§ñ –í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏]
     [üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
     [üîë API –∫–ª—é—á WB]
     [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

2. **–í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [ü§ñ –í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏]
–ë–æ—Ç: ü§ñ –í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏
     
     –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å: GPT-4o Mini (OpenAI)
     
     –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:
     
     ‚Ä¢ GPT-4o Mini (OpenAI)
       –ë—ã—Å—Ç—Ä–∞—è –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å –æ—Ç OpenAI
     
     ‚Ä¢ Claude Sonnet 3.5 (Anthropic)
       –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–æ–¥–µ–ª—å —Å –≥–ª—É–±–æ–∫–∏–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
     
     –í—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è:
     ‚Ä¢ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
     ‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂
     ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
     
     –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å:
     [‚úÖ GPT-4o Mini]
     [Claude Sonnet 3.5]
     [‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º]
```

3. **–°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [Claude Sonnet 3.5]
–ë–æ—Ç: ‚úÖ –ú–æ–¥–µ–ª—å Claude Sonnet 3.5 (Anthropic) –≤—ã–±—Ä–∞–Ω–∞!
     
     [GPT-4o Mini]
     [‚úÖ Claude Sonnet 3.5]
     [‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º]
```

## üé® UI/UX –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- ‚úÖ - —Ç–µ–∫—É—â–∞—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- ü§ñ - –∏–∫–æ–Ω–∫–∞ AI –º–æ–¥–µ–ª–∏
- ‚öôÔ∏è - –∏–∫–æ–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- –£–∫–∞–∑–∞–Ω–∏–µ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏

### –ù–∞–≤–∏–≥–∞—Ü–∏—è
- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ
- –õ–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ /settings

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
try:
    # –ü–æ–ª—É—á–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞: {e}")
    await callback.answer(
        "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫",
        show_alert=True
    )
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
logger.info(
    f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {callback.from_user.id} –≤—ã–±—Ä–∞–ª –º–æ–¥–µ–ª—å {model_id}"
)
```

### Fallback –∑–Ω–∞—á–µ–Ω–∏—è
- –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
bot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py                  # ‚úÖ –ù–æ–≤—ã–π handler
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.py                 # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ client.py                    # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã
‚îî‚îÄ‚îÄ __main__.py                      # ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω router
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
```bash
cd bot
python -m bot
```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã:**
- `/settings` - –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ù–∞–∂–∞—Ç—å "ü§ñ –í—ã–±–æ—Ä AI –º–æ–¥–µ–ª–∏"
- –í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
tail -f bot.log | grep "AI –º–æ–¥–µ–ª—å"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
from bot.api.client import BotAPIClient

client = BotAPIClient()
settings = await client.get_user_settings(123456789)
print(settings["preferred_ai_model"])  # "gpt-4o-mini" –∏–ª–∏ "claude-sonnet-3.5"
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

- [x] **–≠—Ç–∞–ø 1:** –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î ‚úÖ
- [x] **–≠—Ç–∞–ø 2:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π ‚úÖ
- [x] **–≠—Ç–∞–ø 3:** –°–æ–∑–¥–∞—Ç—å API endpoints ‚úÖ
- [x] **–≠—Ç–∞–ø 4:** –û–±–Ω–æ–≤–∏—Ç—å Telegram –±–æ—Ç–∞ ‚úÖ
- [ ] **–≠—Ç–∞–ø 5:** –û–±–Ω–æ–≤–∏—Ç—å GPT —Å–µ—Ä–≤–∏—Å
- [ ] **–≠—Ç–∞–ø 6:** –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª—ã
- [ ] **–≠—Ç–∞–ø 7:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **–≠—Ç–∞–ø 8:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- UI –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –í—Å–µ handlers –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API —Ä–∞–±–æ—Ç–∞–µ—Ç
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É
