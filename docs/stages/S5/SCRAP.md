# üìò –¢–ó: –°–∫—Ä–∞–ø–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ Wildberries

---

## üéØ –¶–µ–ª—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

- **–¶–µ–ª—å:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —Å–±–æ—Ä–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Wildberries –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç —ç—Ç–∞–ø–∞:** —á–∞—Å—Ç—å —ç—Ç–∞–ø–∞ `S5` (`AI-—Å–µ—Ä–≤–∏—Å`) –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏ –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ü–æ—Å—Ç–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç backend `FastAPI` —Å –æ—á–µ—Ä–µ–¥—è–º–∏ `Celery` –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `PostgreSQL + Redis`.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω—ã/—Ç–æ–≤–∞—Ä—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–∫—Ä–∞–ø–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ JSON –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏–π).

---

## üßæ –¢–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

- **–ö–∞—Ä—Ç–æ—á–∫–∞ WB** ‚Äî –ø—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ Wildberries (URL –≤–∏–¥–∞ `https://www.wildberries.ru/catalog/<nm_id>/detail.aspx`).
- **–ú–∞–≥–∞–∑–∏–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞** ‚Äî –º–∞—Ä—à—Ä—É—Ç WB —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞/–±—Ä–µ–Ω–¥–∞ (URL –≤–∏–¥–∞ `https://www.wildberries.ru/seller/<seller_id>` –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤–∞—è –≤—ã–¥–∞—á–∞ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º).
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ** ‚Äî –Ω–∞–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, –æ–ø–∏—Å–∞–Ω–∏–π –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.
- **–ó–∞–¥–∞—á–∞ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞** ‚Äî Celery-–∑–∞–¥–∞—á–∞, –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü.

---

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞—ë—Ç 1..N —Å—Å—ã–ª–æ–∫ (–∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–∞–≥–∞–∑–∏–Ω–∞) —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–æ—Ç/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –î–ª—è –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º:
  - `id`, `cabinet_id`, `product_url`, `type` (`product`/`catalog`), `status`, `last_scraped_at`, `created_at`, `updated_at`, `meta`.
- –°—Å—ã–ª–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã –≤ —Ä–∞–∑—Ä–µ–∑–µ `cabinet_id`.
- –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å API/—Å–æ–±—ã—Ç–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç–∞—Ç—É—Å–∞).

### 2. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
- –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è Celery-–∑–∞–¥–∞—á–∞ `scrape_competitor:<id>`.
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (beat/cron) –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ env `COMPETITOR_SCRAPE_CRON`).
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é < 7 –¥–Ω–µ–π –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏.

### 3. –°–∫—Ä–∞–ø–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
  - –ü—Ä—è–º–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ ‚Üí –ø–∞—Ä—Å–∏—Ç—å HTML –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ JSON, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π —Å–∫—Ä–∏–ø—Ç–∞–º–∏ (`card.json`, `basket.json`, `product-card.json`).
  - –°–ø–∏—Å–∫–∏/–∫–∞—Ç–∞–ª–æ–≥–∏ ‚Üí –∏–∑–≤–ª–µ–∫–∞—Ç—å `nm_id` —Ç–æ–≤–∞—Ä–æ–≤, —Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á–∏ –Ω–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç–æ—á–∫—É.
- –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –ø–æ–ª—è:
  - –û–±—â–∏–µ: `nm_id`, `url`, `seller_id`, `brand`, `category_path`, `rating`, `feedbacks_count`, `price_current`, `price_original`, `discount_percent`.
  - –ö–æ–Ω—Ç–µ–Ω—Ç: `title`, `short_description`, `full_description`, `characteristics` (—Å–ª–æ–≤–∞—Ä—å/JSON), `composition`, `photos` (–º–∞—Å—Å–∏–≤ URL), `video_urls`.
  - –û—Ç–∑—ã–≤—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, top-N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö): `author`, `rating`, `text`, `created_at`, `advantages`, `disadvantages`.
  - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `scraped_at`, `source_link_id`, `hash_content` (–¥–ª—è –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏), `raw_payload` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä).
- –î–ª—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–≤—è–∑—å `link_id ‚Üí [nm_id]`.

### 4. –û—á–∏—Å—Ç–∫–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –í—ã–¥–µ–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å `CompetitorCardNormalizer`, –∫–æ—Ç–æ—Ä—ã–π:
  - –£–¥–∞–ª—è–µ—Ç HTML —Ç–µ–≥–∏, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã.
  - –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ü–µ–Ω—ã (–∫–æ–ø–µ–π–∫–∏ ‚Üí —Ä—É–±–ª–∏).
  - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON (`[{name, value}]`).
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç stemming/lemmatization —Ç–µ–∫—Å—Ç–∞ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ñ–ª–∞–≥ `ENABLE_STEMMING`).
- –•—Ä–∞–Ω–∏—Ç—å –æ—á–∏—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ –≤ `competitor_products_clean`.

### 5. –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
- Backend –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/v1/competitors/cards` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `cabinet_id`, `nm_id?`, `updated_after?`.
- –û—Ç–≤–µ—Ç: —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å –æ—á–∏—â–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏, –º–µ—Ç–∫–∞–º–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏, —Å–ø–∏—Å–∫–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
- –î–ª—è AI-—Å–µ—Ä–≤–∏—Å–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –ø–∞—á–∫–∞–º–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞.

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (retry) –¥–æ 3 —Ä–∞–∑ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤: `pending`, `in_progress`, `completed`, `failed`, `blocked`.
- –ï—Å–ª–∏ WB –æ—Ç–¥–∞—ë—Ç –∫–∞–ø—á—É/403 ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–∫—Å–∏/—é–∑–µ—Ä-–∞–≥–µ–Ω—Ç–∞, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ `on_hold`, —É–≤–µ–¥–æ–º–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫—É/–∞–ª–µ—Ä—Ç.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot / UI‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Backend FastAPI     ‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ PostgreSQL      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ ‚Ä¢ competitor_links  ‚îÇ      ‚îÇ ‚Ä¢ competitor_*  ‚îÇ
                          ‚îÇ ‚Ä¢ REST API          ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ ‚Ä¢ Celery producer   ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ≤‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
                                   ‚îÇ Celery tasks (Redis broker)
                                   ‚ñº
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ Scraper Worker     ‚îÇ
                          ‚îÇ ‚Ä¢ HTTP client      ‚îÇ
                          ‚îÇ ‚Ä¢ Anti-bot logic   ‚îÇ
                          ‚îÇ ‚Ä¢ Normalizer       ‚îÇ
                          ‚îÇ ‚Ä¢ Storage service  ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- `CompetitorLinkService` ‚Äî CRUD –ø–æ —Å—Å—ã–ª–∫–∞–º, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á.
- `CompetitorScrapeTask` ‚Äî Celery-–∑–∞–¥–∞—á–∞, orchestrator —Å–∫—Ä–∞–ø–∏–Ω–≥–∞.
- `WBPageFetcher` ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏, —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è `User-Agent`, timeouts).
- `WBProductParser` ‚Äî –º–æ–¥—É–ª—å –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML/JSON.
- `CompetitorDataRepository` ‚Äî –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–∞–º `competitor_links`, `competitor_products_raw`, `competitor_products_clean`, `competitor_reviews`.
- `ScrapeTelemetry` ‚Äî —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (—É—Å–ø–µ—à–Ω–æ—Å—Ç—å, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏).

---

## üóÉÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

```sql
CREATE TABLE competitor_links (
    id BIGSERIAL PRIMARY KEY,
    cabinet_id BIGINT NOT NULL REFERENCES wb_cabinets(id),
    product_url TEXT NOT NULL,
    type VARCHAR(16) NOT NULL DEFAULT 'product',
    status VARCHAR(16) NOT NULL DEFAULT 'active',
    meta JSONB DEFAULT '{}'::jsonb,
    last_scraped_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (cabinet_id, product_url)
);

CREATE TABLE competitor_products_raw (
    id BIGSERIAL PRIMARY KEY,
    link_id BIGINT NOT NULL REFERENCES competitor_links(id) ON DELETE CASCADE,
    nm_id BIGINT NOT NULL,
    seller_id BIGINT,
    payload JSONB NOT NULL,
    scraped_at TIMESTAMP WITH TIME ZONE NOT NULL,
    hash_content CHAR(64) NOT NULL,
    CONSTRAINT competitor_products_raw_unique UNIQUE (link_id, nm_id, hash_content)
);

CREATE TABLE competitor_products_clean (
    id BIGSERIAL PRIMARY KEY,
    raw_id BIGINT NOT NULL REFERENCES competitor_products_raw(id) ON DELETE CASCADE,
    nm_id BIGINT NOT NULL,
    data JSONB NOT NULL,
    price_current NUMERIC(12,2),
    price_original NUMERIC(12,2),
    rating NUMERIC(3,2),
    feedbacks_count INTEGER,
    scraped_at TIMESTAMP WITH TIME ZONE NOT NULL
);

CREATE TABLE competitor_reviews (
    id BIGSERIAL PRIMARY KEY,
    clean_id BIGINT NOT NULL REFERENCES competitor_products_clean(id) ON DELETE CASCADE,
    review_id BIGINT,
    rating SMALLINT,
    author TEXT,
    advantages TEXT,
    disadvantages TEXT,
    text TEXT,
    created_at TIMESTAMP WITH TIME ZONE,
    payload JSONB
);
```

–¢—Ä–∏–≥–≥–µ—Ä—ã/—Ñ—É–Ω–∫—Ü–∏–∏:
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at` –¥–ª—è `competitor_links`.
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π: cron-—Ñ—É–Ω–∫—Ü–∏—è, —É–¥–∞–ª—è—é—â–∞—è `competitor_products_raw` —Å—Ç–∞—Ä—à–µ `RETENTION_DAYS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30).

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–Ø–∑—ã–∫ –∏ —Å—Ç–µ–∫:** Python 3.11+, FastAPI, SQLAlchemy, Celery 5, Redis (broker), PostgreSQL 14+.
- **HTTP-–∫–ª–∏–µ–Ω—Ç:** `httpx` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∞–π–º–∞—É—Ç–æ–≤, –ø–æ–≤—Ç–æ—Ä–æ–≤, –ø—Ä–æ–∫—Å–∏; –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ env.
- **–ü–∞—Ä—Å–∏–Ω–≥:** `selectolax` –∏–ª–∏ `lxml` –¥–ª—è HTML, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `json` –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ env:**
  - `COMPETITOR_SCRAPE_CRON` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
  - `COMPETITOR_MAX_DEPTH` ‚Äî –ª–∏–º–∏—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ —Å –æ–¥–Ω–æ–π —Å—Å—ã–ª–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100).
  - `WB_PROXY_POOL` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏ (JSON/CSV).
  - `SCRAPER_USER_AGENTS` ‚Äî —Å–ø–∏—Å–æ–∫ user-agent —Å—Ç—Ä–æ–∫.
  - `SCRAPER_TIMEOUT` (—Å–µ–∫), `SCRAPER_RETRY_COUNT`.
  - `SCRAPER_RETRY_BACKOFF` (—Å–µ–∫).
  - `SCRAPER_REVIEW_LIMIT` (int).

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å

- –°–æ–±–ª—é–¥–∞–µ–º robots.txt –∏ –ª–µ–≥–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è; –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∑–∞–ø—Ä–µ—Ç–∞ ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä–∞–ø–∏–Ω–≥ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤: –Ω–µ –±–æ–ª–µ–µ 1 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫ –Ω–∞ –¥–æ–º–µ–Ω –æ—Ç –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ (rate limiter).
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
- –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (—Ç–µ–∫—Å—Ç—ã) —Ö—Ä–∞–Ω–∏–º –≤ –ë–î –ø—Ä–æ–µ–∫—Ç–∞.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –º–∞—Å—Å–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–±–æ–ª–µ–µ 5 `403` –ø–æ–¥—Ä—è–¥).

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á.
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–∫–∏.
- –ü—Ä–æ—Ü–µ–Ω—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫/–ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö.
- –ö–æ–ª-–≤–æ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö `nm_id` –ø–æ —Å—Å—ã–ª–∫–µ.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –∏ —á–∞—Å—Ç–æ—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
- –ê–ª–µ—Ä—Ç—ã –≤ Grafana/Prometheus –ø–æ –æ—à–∏–±–∫–∞–º –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- **Unit-—Ç–µ—Å—Ç—ã:**
  - –ü–∞—Ä—Å–µ—Ä HTML/JSON (–º–æ–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü).
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å—Ç–∫–∏, —Ü–µ–Ω, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫).
  - –°–µ—Ä–≤–∏—Å —Å—Å—ã–ª–æ–∫ (CRUD, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á).
- **Integration-—Ç–µ—Å—Ç—ã:**
  - Celery-–ø–∞–π–ø–ª–∞–π–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Redis` test –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î.
- **E2E (—Ä—É—á–Ω—ã–µ):**
  - –ü—Ä–æ–≥–æ–Ω —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ (dev-–æ–∫—Ä—É–∂–µ–Ω–∏–µ).
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–∏–º–∏—Ç–∞—Ü–∏—è beat).
- **–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ:**
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ 500 –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–∞ —á–∞—Å ‚Üí –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å—Å—ã–ª–æ–∫, –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ API.
- –°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä–∞–ø–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—Å—ã–ª–æ–∫ (—Ç–æ–≤–∞—Ä, –º–∞–≥–∞–∑–∏–Ω).
- –í –ë–î –ø–æ—è–≤–ª—è—é—Ç—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è (`title`, `description`, `characteristics`, `price`, `rating`, `reviews`).
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ –∑–∞ —Å—á—ë—Ç `hash_content`.
- –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç JSON-—Å—Ö–µ–º–µ.
- Errors/Retry –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è, —Å–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º.
- –¢–µ—Å—Ç—ã (unit + integration) –ø–æ–∫—Ä—ã–≤–∞—é—Ç ‚â• 80% –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.

---

## üóìÔ∏è –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

1. **–ù–µ–¥–µ–ª—è 1**
   - –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î, –º–∏–≥—Ä–∞—Ü–∏–∏.
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `CompetitorLinkService`, API.
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Celery-–∑–∞–¥–∞—á.
2. **–ù–µ–¥–µ–ª—è 2**
   - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ `WBPageFetcher`, `WBProductParser`.
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
3. **–ù–µ–¥–µ–ª—è 3**
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ë–î (`competitor_*`) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Celery, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `competitor_products_raw`.
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø–∏—Å—å –≤ `competitor_products_clean`.
4. **–ù–µ–¥–µ–ª—è 4**
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –æ—Ç–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.
   - –¢–µ—Å—Ç—ã, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–ª–µ—Ä—Ç—ã.
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–∫—ç—à, –ø—Ä–æ–∫—Å–∏, rate limiting).

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

- –û–±–Ω–æ–≤–∏—Ç—å `SPEC_TECH.md` —Ä–∞–∑–¥–µ–ª–æ–º –ø—Ä–æ —Å–∫—Ä–∞–ø–∏–Ω–≥ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
- –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–∫–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –∫–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–∫—Å–∏).
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–ª—è –∫–æ–º–∞–Ω–¥—ã AI –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –∏–∑ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞.

---

*–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:* –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.  
*–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:* –∫–æ–º–∞–Ω–¥–∞ backend/AI (FastAPI).  
*–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:* 12.11.2025.

