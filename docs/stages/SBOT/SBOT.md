# SBOT - –ë–æ—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ –≤ –∫–∞–Ω–∞–ª—ã

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**SBOT (Summary Bot)** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ –ø–æ –∫–∞–±–∏–Ω–µ—Ç–∞–º Wildberries –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∏–ª–∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã.

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è
–í–ª–∞–¥–µ–ª—å—Ü—ã –±–∏–∑–Ω–µ—Å–∞ —Ö–æ—Ç—è—Ç –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –≤ —Å–≤–æ–∏—Ö —Ä–∞–±–æ—á–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö/—á–∞—Ç–∞—Ö, –Ω–µ –∑–∞—Ö–æ–¥—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –í–∏–¥–µ—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–º–∞–Ω–¥–Ω—ã—Ö —á–∞—Ç–∞—Ö
- –î–µ–ª–∏—Ç—å—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
- –ü–æ–ª—É—á–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—É—é —Å–≤–æ–¥–∫—É –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –µ–µ –≤—Ä—É—á–Ω—É—é
- –í–µ—Å—Ç–∏ –∏—Å—Ç–æ—Ä–∏—é –æ—Ç—á–µ—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª–µ

### –û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç** (`bot/`) ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **SBOT** (`bot_young/`) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª—ã

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Celery** –∏–∑ `server/`
- –ù–µ —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π Celery –¥–ª—è bot_young
- –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –æ—á–µ—Ä–µ–¥—å `digest_queue` –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
- –†–∞—Å—à–∏—Ä—è–µ–º `beat_schedule` –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏

‚úÖ **bot_young - —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
- –ë–µ–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- –¢–æ–ª—å–∫–æ handlers –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–æ–≤
- –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —Å–µ—Ä–≤–∏—Å

‚úÖ **Celery tasks –≤ server/**
- `server/app/features/digest/tasks.py` - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ `BOT_YOUNG_TOKEN`
- –ï–¥–∏–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–¥–∞—á

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     SBOT (bot_young)                            ‚îÇ
‚îÇ                  Telegram Bot (Interactive)                     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚Ä¢ /start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–æ–≤                  ‚îÇ
‚îÇ  ‚Ä¢ Add channel - FSM –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞                     ‚îÇ
‚îÇ  ‚Ä¢ Set time - –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏                           ‚îÇ
‚îÇ  ‚Ä¢ Manage channels - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ HTTP API (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–æ–≤)
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Main Server (FastAPI)                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              NEW: Channel Digest API                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  GET  /api/v1/digest/daily?user_id=X&cabinet_id=Y      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  POST /api/v1/channels/                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  GET  /api/v1/channels/?user_id=X                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  PUT  /api/v1/channels/{id}                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  DELETE /api/v1/channels/{id}                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              Existing: Bot API                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  /api/v1/bot/dashboard                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  /api/v1/bot/orders                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ         EXISTING: Celery Tasks (–†–ê–°–®–ò–†–ï–ù–ò–ï)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Existing queues:                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ sync_queue - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è WB                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ alerts_queue - –∞–ª–µ—Ä—Ç—ã –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ export_queue - —ç–∫—Å–ø–æ—Ä—Ç –≤ Google Sheets               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  NEW queue:                                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ digest_queue - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–æ–∫ –≤ –∫–∞–Ω–∞–ª—ã              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  NEW tasks:                                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ check_digest_schedule() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ send_digest_to_channel(channel_id) - –æ—Ç–ø—Ä–∞–≤–∫–∞        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ         Redis (Shared Broker)         ‚îÇ
        ‚îÇ  ‚Ä¢ Celery tasks queue                 ‚îÇ
        ‚îÇ  ‚Ä¢ Beat schedule persistence          ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚Üì
                  PostgreSQL DB
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ ‚Ä¢ users         ‚îÇ
                  ‚îÇ ‚Ä¢ wb_cabinets   ‚îÇ
                  ‚îÇ ‚Ä¢ cabinet_users ‚îÇ
                  ‚îÇ ‚Ä¢ channel_reports (NEW) ‚îÇ
                  ‚îÇ ‚Ä¢ digest_history  (NEW) ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Bot Service (bot_young/):**
- Python 3.11+
- Aiogram 3.x (Telegram Bot framework)
- aiohttp (–¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Server API)
- **–ë–ï–ó —Å–≤–æ–µ–≥–æ Celery** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–∑ server/

**Backend Extensions (server/):**
- FastAPI (–Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤)
- SQLAlchemy (–Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ë–î)
- **Celery Tasks** (–Ω–æ–≤–∞—è –æ—á–µ—Ä–µ–¥—å `digest_queue` –∏ –∑–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏)
- **Celery Beat** (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ beat_schedule –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏)

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: `channel_reports`

–•—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–æ–∫.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
channel_reports
‚îú‚îÄ‚îÄ id: Integer (PK, autoincrement)
‚îú‚îÄ‚îÄ user_id: Integer (FK -> users.id, NOT NULL)
‚îú‚îÄ‚îÄ cabinet_id: Integer (FK -> wb_cabinets.id, NOT NULL)
‚îú‚îÄ‚îÄ chat_id: BigInteger (Telegram chat ID, NOT NULL)
‚îú‚îÄ‚îÄ chat_title: String(255) (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞/—á–∞—Ç–∞, nullable)
‚îú‚îÄ‚îÄ chat_type: String(50) (—Ç–∏–ø: 'channel', 'group', 'supergroup')
‚îú‚îÄ‚îÄ report_time: Time (–≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä 09:00:00)
‚îú‚îÄ‚îÄ timezone: String(50) (—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä 'Europe/Moscow', default='Europe/Moscow')
‚îú‚îÄ‚îÄ is_active: Boolean (–≤–∫–ª/–≤—ã–∫–ª, default=True)
‚îú‚îÄ‚îÄ last_sent_at: DateTime (–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏, nullable)
‚îú‚îÄ‚îÄ created_at: DateTime (–¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è)
‚îú‚îÄ‚îÄ updated_at: DateTime (–¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

Indexes:
- idx_user_id (user_id)
- idx_cabinet_id (cabinet_id)
- idx_chat_id (chat_id)
- idx_is_active_report_time (is_active, report_time) - –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

Unique Constraints:
- uq_chat_cabinet (chat_id, cabinet_id) - –æ–¥–∏–Ω –∫–∞–±–∏–Ω–µ—Ç -> –æ–¥–∏–Ω –∫–∞–Ω–∞–ª —Ç–æ–ª—å–∫–æ —Ä–∞–∑
```

**–°–≤—è–∑–∏:**
- `user_id` ‚Üí `users.id` (–≤–ª–∞–¥–µ–ª–µ—Ü –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- `cabinet_id` ‚Üí `wb_cabinets.id` (–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û–¥–∏–Ω –∫–∞–Ω–∞–ª –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–≤–æ–¥–∫–∏ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π.

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: `digest_history`

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏).

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
digest_history
‚îú‚îÄ‚îÄ id: Integer (PK)
‚îú‚îÄ‚îÄ channel_report_id: Integer (FK -> channel_reports.id, NOT NULL)
‚îú‚îÄ‚îÄ cabinet_id: Integer (FK -> wb_cabinets.id, NOT NULL)
‚îú‚îÄ‚îÄ chat_id: BigInteger (–∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ digest_date: Date (–∑–∞ –∫–∞–∫–æ–π –¥–µ–Ω—å —Å–≤–æ–¥–∫–∞)
‚îú‚îÄ‚îÄ sent_at: DateTime (–∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ status: String(20) ('sent', 'failed', 'retry')
‚îú‚îÄ‚îÄ error_message: Text (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞, nullable)
‚îú‚îÄ‚îÄ message_id: BigInteger (ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram, nullable)
‚îú‚îÄ‚îÄ retry_count: Integer (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫, default=0)
‚îú‚îÄ‚îÄ created_at: DateTime

Indexes:
- idx_channel_report_id (channel_report_id)
- idx_digest_date (digest_date)
- idx_status (status)
```

---

## üîÑ User Flow (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start –≤ SBOT
   ‚Üì
2. SBOT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç user_id –≤ –ë–î:
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç ‚Üí –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É users
   - –ò—â–µ—Ç –∫–∞–±–∏–Ω–µ—Ç—ã —á–µ—Ä–µ–∑ cabinet_users
   ‚Üì
3–∞. –ï—Å–ª–∏ –ù–ï–¢ –∫–∞–±–∏–Ω–µ—Ç–æ–≤:
    SBOT ‚Üí "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤ WB"
    SBOT ‚Üí –ö–Ω–æ–ø–∫–∞ "üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç" (—Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞)
    [–ö–æ–Ω–µ—Ü —Å—Ü–µ–Ω–∞—Ä–∏—è]
   
3–±. –ï—Å–ª–∏ –ï–°–¢–¨ –∫–∞–±–∏–Ω–µ—Ç(—ã):
    SBOT ‚Üí "–ù–∞–π–¥–µ–Ω –∫–∞–±–∏–Ω–µ—Ç: {cabinet_name}"
    SBOT ‚Üí "–î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –∫–∞–Ω–∞–ª/—á–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å—Å—ã–ª–∫—É –∏–ª–∏ @username –∫–∞–Ω–∞–ª–∞"
    ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
   - –í–∞—Ä–∏–∞–Ω—Ç –ê: @mychannel
   - –í–∞—Ä–∏–∞–Ω—Ç –ë: https://t.me/mychannel
   - –í–∞—Ä–∏–∞–Ω—Ç –í: Forward —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞
   ‚Üì
5. SBOT –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–∞–Ω–∞–ª:
   5.1. –ü–æ–ª—É—á–∞–µ—Ç chat_id —á–µ—Ä–µ–∑ API
   5.2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª (bot.get_chat_member())
   5.3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –ø—Ä–∞–≤–æ–º –ø–æ—Å—Ç–∏–Ω–≥–∞)
   ‚Üì
6–∞. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ù–ï –ø—Ä–æ—à–ª–∞:
    SBOT ‚Üí "‚ùå –û—à–∏–±–∫–∞: [–ø—Ä–∏—á–∏–Ω–∞]"
    SBOT ‚Üí "–î–æ–±–∞–≤—å—Ç–µ –º–µ–Ω—è –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø—Ä–∞–≤–æ–º –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"
    [–í–æ–∑–≤—Ä–∞—Ç –∫ —à–∞–≥—É 4]
   
6–±. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞:
    SBOT ‚Üí "‚úÖ –ö–∞–Ω–∞–ª '{chat_title}' –ø–æ–¥–∫–ª—é—á–µ–Ω!"
    SBOT ‚Üí "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏:"
    SBOT ‚Üí Inline-–∫–Ω–æ–ø–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ (—Å–º. –Ω–∏–∂–µ)
    ‚Üì
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 09:00)
   ‚Üì
8. SBOT —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ channel_reports:
   - user_id, cabinet_id, chat_id, report_time, is_active=True
   ‚Üì
9. SBOT ‚Üí "‚úÖ –ì–æ—Ç–æ–≤–æ! –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–æ–¥–∫–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ {chat_title} –≤ {report_time} –ú–°–ö"
   SBOT ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏

**–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é SBOT:**
```
üì¢ –ú–æ–∏ –∫–∞–Ω–∞–ª—ã (3)
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚ÑπÔ∏è –ü–æ–º–æ—â—å
```

**üì¢ –ú–æ–∏ –∫–∞–Ω–∞–ª—ã:**
```
–°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

1. üì¢ –ö–∞–Ω–∞–ª "Sales Reports"
   –ö–∞–±–∏–Ω–µ—Ç: WB Store #1
   –í—Ä–µ–º—è: 09:00 –ú–°–ö
   –°—Ç–∞—Ç—É—Å: ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
   [–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è] [–í—ã–∫–ª—é—á–∏—Ç—å] [–£–¥–∞–ª–∏—Ç—å]

2. üì¢ –ì—Ä—É–ø–ø–∞ "Team Chat"
   –ö–∞–±–∏–Ω–µ—Ç: WB Store #1
   –í—Ä–µ–º—è: 18:00 –ú–°–ö
   –°—Ç–∞—Ç—É—Å: ‚è∏ –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   [–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è] [–í–∫–ª—é—á–∏—Ç—å] [–£–¥–∞–ª–∏—Ç—å]

[+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª]
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- **–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è:** –ü–æ–∫–∞–∑–∞—Ç—å inline-–∫–Ω–æ–ø–∫–∏ —Å –≤—ã–±–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–í—ã–∫–ª—é—á–∏—Ç—å/–í–∫–ª—é—á–∏—Ç—å:** –ò–∑–º–µ–Ω–∏—Ç—å `is_active` –≤ –ë–î
- **–£–¥–∞–ª–∏—Ç—å:** –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ `channel_reports` (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–ú–æ–∏ –∫–∞–Ω–∞–ª—ã" ‚Üí [+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª]
   ‚Üì
2. SBOT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤:
   (–û–±—ã—á–Ω–æ –æ–¥–∏–Ω, –Ω–æ –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî –≤—ã–±–æ—Ä)
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–±–∏–Ω–µ—Ç
   ‚Üì
4-9. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–π 1 (—à–∞–≥–∏ 4-9)
```

---

## üïê –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ Inline-–∫–Ω–æ–ø–∫–∏

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏:**

```
–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–∫–∏ (–ú–°–ö):

üåÖ –£—Ç—Ä–æ
[06:00] [07:00] [08:00] [09:00]

‚òÄÔ∏è –î–µ–Ω—å
[12:00] [13:00] [14:00] [15:00]

üåÜ –í–µ—á–µ—Ä
[18:00] [19:00] [20:00] [21:00]

üåô –ù–æ—á—å
[00:00] [03:00]

[‚öôÔ∏è –°–≤–æ–µ –≤—Ä–µ–º—è]
```

**–û–ø—Ü–∏—è "–°–≤–æ–µ –≤—Ä–µ–º—è":**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≤—Ä–µ–º—è –≤—Ä—É—á–Ω—É—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM (–Ω–∞–ø—Ä–∏–º–µ—Ä, "10:30")
- SBOT –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç

---

## üìä –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (v1.0 - MVP)

–°–≤–æ–¥–∫–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ Dashboard, –Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤.

```
üìä –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ WB
üè¢ {cabinet_name}
üìÖ {yesterday_date}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üõí –ó–ê–ö–ê–ó–´
‚Ä¢ –ù–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤: {orders_count}
‚Ä¢ –ù–∞ —Å—É–º–º—É: {orders_amount}‚ÇΩ
‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞: {+/-X%} –∫ –ø–æ–∑–∞–≤—á–µ—Ä–∞

üí∞ –ü–†–û–î–ê–ñ–ò
‚Ä¢ –í—ã–∫—É–ø–æ–≤: {buyouts_count} ({buyouts_amount}‚ÇΩ)
‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç–æ–≤: {returns_count} ({returns_amount}‚ÇΩ)
‚Ä¢ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–∫—É–ø–∞: {buyout_rate}%

üì¶ –û–°–¢–ê–¢–ö–ò
‚Ä¢ –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤: {critical_stocks_count}
‚Ä¢ –¢–æ–≤–∞—Ä–æ–≤ —Å –Ω—É–ª–µ–≤—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º: {zero_stocks_count}
‚Ä¢ –¢—Ä–µ–±—É—é—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è: {attention_needed}

‚≠ê –û–¢–ó–´–í–´
‚Ä¢ –ù–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤: {new_reviews}
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: {avg_rating}/5 ‚≠ê
‚Ä¢ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö (1-3‚òÖ): {negative_reviews}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üïê –û–±–Ω–æ–≤–ª–µ–Ω–æ: {timestamp}
ü§ñ WB Assist Bot
```

### Inline-–∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º

```
[üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç] [‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á–µ—Ç—ã]
```

- **–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:** Deep link –≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á–µ—Ç—ã:** Deep link –≤ SBOT –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## üîå API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (Backend Extensions)

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/v1/digest/daily`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int, required) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `cabinet_id` (int, required) - ID –∫–∞–±–∏–Ω–µ—Ç–∞
- `date` (str, optional) - –î–∞—Ç–∞ —Å–≤–æ–¥–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤—á–µ—Ä–∞)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "cabinet_name": "WB Store #1",
    "date": "2025-11-06",
    "orders": {
      "count": 45,
      "amount": 125000,
      "growth_percent": 12.5
    },
    "sales": {
      "buyouts_count": 38,
      "buyouts_amount": 110000,
      "returns_count": 2,
      "returns_amount": 5000,
      "buyout_rate": 95.0
    },
    "stocks": {
      "critical_count": 5,
      "zero_count": 2,
      "attention_needed": 7
    },
    "reviews": {
      "new_count": 8,
      "average_rating": 4.7,
      "negative_count": 1
    }
  },
  "telegram_text": "üìä –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ WB\n..."
}
```

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏

#### 2.1. –°–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞–Ω–∞–ª–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/v1/channels/`

**Body:**
```json
{
  "user_id": 123,
  "cabinet_id": 456,
  "chat_id": -1001234567890,
  "chat_title": "Sales Reports",
  "chat_type": "channel",
  "report_time": "09:00:00",
  "timezone": "Europe/Moscow"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "id": 789,
    "user_id": 123,
    "cabinet_id": 456,
    "chat_id": -1001234567890,
    "chat_title": "Sales Reports",
    "report_time": "09:00:00",
    "is_active": true,
    "created_at": "2025-11-07T10:30:00Z"
  }
}
```

#### 2.2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/v1/channels/`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int, required)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "channels": [
      {
        "id": 789,
        "cabinet_name": "WB Store #1",
        "chat_title": "Sales Reports",
        "report_time": "09:00:00",
        "is_active": true,
        "last_sent_at": "2025-11-07T09:00:00Z"
      }
    ],
    "total": 1
  }
}
```

#### 2.3. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞–Ω–∞–ª–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/v1/channels/{channel_id}`

**Body:**
```json
{
  "report_time": "10:00:00",
  "is_active": false
}
```

#### 2.4. –£–¥–∞–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞–Ω–∞–ª–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `DELETE /api/v1/channels/{channel_id}`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int, required) - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–∫–∏ (Flow)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (Celery Beat)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Task: check_digest_schedule()                                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (UTC)                               ‚îÇ
‚îÇ  2. SELECT * FROM channel_reports                              ‚îÇ
‚îÇ     WHERE is_active=true AND report_time=current_time          ‚îÇ
‚îÇ  3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞:                                        ‚îÇ
‚îÇ     ‚Üí send_digest_to_channel.delay(channel_id)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ digest_queue)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Task: send_digest_to_channel(channel_report_id)               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞ –∏–∑ –ë–î (chat_id, cabinet_id)     ‚îÇ
‚îÇ  2. –í—ã–∑–≤–∞—Ç—å DigestService.get_daily_digest(cabinet_id)         ‚îÇ
‚îÇ  3. –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–≤–æ–¥–∫–∏                      ‚îÇ
‚îÇ  4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram Bot API (BOT_YOUNG_TOKEN)        ‚îÇ
‚îÇ  5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ digest_history                       ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  –ü—Ä–∏ –æ—à–∏–±–∫–µ:                                                    ‚îÇ
‚îÇ  ‚Üí Retry 3 —Ä–∞–∑–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 60 —Å–µ–∫                            ‚îÇ
‚îÇ  ‚Üí –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - status='failed' –≤ –ë–î                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä—è–µ–º **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Celery** –∏–∑ `server/app/core/celery_app.py`.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (`server/celery_beat.py`)
- ‚úÖ Shared Redis broker
- ‚úÖ –ï–¥–∏–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–¥–∞—á
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è retry –ª–æ–≥–∏–∫–∞
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Celery:**

1. **–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –æ—á–µ—Ä–µ–¥—å** `digest_queue`
2. **–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** –≤ `server/app/features/digest/tasks.py`
3. **–†–∞—Å—à–∏—Ä—è–µ–º beat_schedule** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:**

```python
# server/app/features/digest/tasks.py

from app.core.celery_app import celery_app

@celery_app.task(name="check_digest_schedule", queue="digest_queue")
def check_digest_schedule():
    """
    –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É —á–µ—Ä–µ–∑ Celery Beat.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∫–∞–Ω–∞–ª—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–∫–∏ –≤ —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É.
    """
    current_time_utc = datetime.now(timezone.utc)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —Å is_active=True
    # –≥–¥–µ report_time —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º (—Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–Ω—É—Ç—ã)
    
    channels_to_send = get_channels_for_current_time(current_time_utc)
    
    for channel in channels_to_send:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–≤–æ–¥–∫–∏
        send_digest_to_channel.delay(channel.id)

@celery_app.task(name="send_digest_to_channel", queue="digest_queue", 
                 max_retries=3, default_retry_delay=60)
def send_digest_to_channel(channel_report_id: int):
    """
    –û—Ç–ø—Ä–∞–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–≤–æ–¥–∫–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª.
    
    Args:
        channel_report_id: ID –∑–∞–ø–∏—Å–∏ –∏–∑ channel_reports
    """
    # 1. –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞ –∏–∑ –ë–î
    # 2. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–≤–æ–¥–∫–∏ —á–µ—Ä–µ–∑ DigestService
    # 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ bot_young token
    # 4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ digest_history
```

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ beat_schedule –≤ `server/app/core/celery_app.py`:**
```python
beat_schedule = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ ...
    
    # NEW: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–æ–∫
    "check-digest-schedule": {
        "task": "check_digest_schedule",
        "schedule": crontab(minute='*'),  # –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    },
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ task_routes:**
```python
task_routes = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã ...
    
    # NEW: –ó–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–¥–æ–∫
    "check_digest_schedule": {"queue": "digest_queue"},
    "send_digest_to_channel": {"queue": "digest_queue"},
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Celery Worker –≤ docker-compose.yml:**
```yaml
celery-worker:
  # ...
  command: celery -A app.core.celery_app worker --loglevel=info 
           --queues=sync_queue,alerts_queue,export_queue,digest_queue
  # –î–æ–±–∞–≤–∏–ª–∏ digest_queue –∫ —Å–ø–∏—Å–∫—É –æ—á–µ—Ä–µ–¥–µ–π
```

### Retry –ª–æ–≥–∏–∫–∞

**–ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å:**
1. Celery –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–¥–∞—á—É (max_retries=3)
2. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ `digest_history` (status='failed')
3. –ß–µ—Ä–µ–∑ 1 —á–∞—Å –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–¥–ª—è —Å–ª—É—á–∞–µ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Telegram API)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω

- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í—Å–µ –≤—Ä–µ–º–µ–Ω–∞ –≤ –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ UTC
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ú–°–ö (Europe/Moscow)
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:** –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `report_time` + `timezone` –≤ UTC –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç: 09:00 –ú–°–ö
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î: report_time=06:00:00 UTC, timezone='Europe/Moscow'
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç: current_time_utc == 06:00
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

**–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞:**

```python
async def validate_bot_in_chat(chat_id: int) -> Dict[str, Any]:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –±–æ—Ç:
    1. –î–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª/—á–∞—Ç
    2. –ò–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    3. –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    """
    try:
        bot_member = await bot.get_chat_member(chat_id, bot.id)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
        if bot_member.status not in ['administrator', 'creator']:
            return {
                "valid": False,
                "error": "–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞"
            }
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
        if bot_member.status == 'administrator':
            if not bot_member.can_post_messages:  # –î–ª—è –∫–∞–Ω–∞–ª–æ–≤
                return {
                    "valid": False,
                    "error": "–£ –±–æ—Ç–∞ –Ω–µ—Ç –ø—Ä–∞–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è"
                }
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
        chat = await bot.get_chat(chat_id)
        
        return {
            "valid": True,
            "chat_title": chat.title,
            "chat_type": chat.type
        }
        
    except Exception as e:
        return {
            "valid": False,
            "error": f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–Ω–∞–ª: {str(e)}"
        }
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞

**–ü–µ—Ä–µ–¥ –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
```sql
SELECT * FROM channel_reports 
WHERE id = ? AND user_id = ?
```

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü ‚Üí 403 Forbidden.

### Rate limiting

- **–î–ª—è –±–æ—Ç–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã Telegram (30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É)
- **–î–ª—è API:** Rate limiting —á–µ—Ä–µ–∑ middleware (—É–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ)

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:**
```json
{
  "timestamp": "2025-11-07T09:00:05Z",
  "level": "INFO",
  "service": "bot_young",
  "event": "digest_sent",
  "channel_report_id": 789,
  "chat_id": -1001234567890,
  "cabinet_id": 456,
  "message_id": 12345,
  "duration_ms": 450
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ (–±—É–¥—É—â–µ–µ)

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ (—É—Å–ø–µ—à–Ω–æ/–Ω–µ—É–¥–∞—á–Ω–æ)
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- –û—à–∏–±–∫–∏ Telegram API

---

## üöÄ –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (2-3 –¥–Ω—è)

**Backend (server/):**
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `server/app/features/digest/`
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ `ChannelReport` –∏ `DigestHistory` –≤ `models.py`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Alembic)
- [ ] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤ –≤ `crud.py`
- [ ] API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ `router.py` (CRUD –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤)
- [ ] DigestService –≤ `service.py` (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–≤–æ–¥–æ–∫)
- [ ] DigestFormatter –≤ `formatter.py` (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram)

**Bot (bot_young/):**
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `bot_young/`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Aiogram 3.x
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env variables)
- [ ] –ë–∞–∑–æ–≤—ã–π `/start` —Ö–µ–Ω–¥–ª–µ—Ä
- [ ] API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ server

### –≠—Ç–∞–ø 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ (3-4 –¥–Ω—è)

**Bot:**
- [ ] FSM –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫/username –∫–∞–Ω–∞–ª–æ–≤
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ
- [ ] Inline-–∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ API

### –≠—Ç–∞–ø 3: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ (3-4 –¥–Ω—è)

**Backend (server/):**
- [ ] –°–æ–∑–¥–∞—Ç—å `server/app/features/digest/tasks.py`
- [ ] Celery –∑–∞–¥–∞—á–∞ `check_digest_schedule()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
- [ ] Celery –∑–∞–¥–∞—á–∞ `send_digest_to_channel()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–∫–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `server/app/core/celery_app.py`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `digest_queue` –≤ task_routes
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `check-digest-schedule` –≤ beat_schedule
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `app.features.digest.tasks` –≤ include
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `digest_queue` –≤ celery-worker
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `BOT_YOUNG_TOKEN` –≤ environment celery-worker
- [ ] Retry –ª–æ–≥–∏–∫–∞ –≤ –∑–∞–¥–∞—á–∞—Ö
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `digest_history`

### –≠—Ç–∞–ø 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ (2-3 –¥–Ω—è)

**Bot:**
- [ ] –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
- [ ] Inline-–∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å–≤–æ–¥–æ–∫

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ (3-4 –¥–Ω—è)

- [ ] Unit —Ç–µ—Å—Ç—ã (–º–æ–¥–µ–ª–∏, CRUD)
- [ ] Integration —Ç–µ—Å—Ç—ã (API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
- [ ] E2E —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–π flow)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] Docker Compose –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –≠—Ç–∞–ø 6: –î–µ–ø–ª–æ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1-2 –¥–Ω—è)

- [ ] Docker –æ–±—Ä–∞–∑ –¥–ª—è `bot_young`
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] Health checks
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–ò—Ç–æ–≥–æ:** ~14-20 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Environment Variables)

### bot_young/.env

```bash
# Telegram Bot
BOT_YOUNG_TOKEN=<token_from_botfather>

# Server API
SERVER_HOST=http://127.0.0.1:8000
API_SECRET_KEY=<shared_secret>

# Logging
LOG_LEVEL=INFO

# Timezone (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
DEFAULT_TIMEZONE=Europe/Moscow
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ .env (–∫–æ—Ä–Ω–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è docker-compose)

```bash
# ... existing variables ...

# NEW: Bot Young Token (–¥–ª—è Celery worker)
BOT_YOUNG_TOKEN=<token_from_botfather>
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** 
- `BOT_YOUNG_TOKEN` –Ω—É–∂–µ–Ω –∫–∞–∫ –≤ `bot_young/`, —Ç–∞–∫ –∏ –≤ `server/celery-worker`
- Celery worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–∞–Ω–∞–ª—ã
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ (`REDIS_URL`, `DATABASE_URL`) —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

---

## üê≥ Docker Compose Integration

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.yml`:**

### 1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å bot_young

```yaml
bot_young:
  build:
    context: .
    dockerfile: bot_young/Dockerfile
  container_name: wb_assist_bot_young
  depends_on:
    - server
    - redis
  environment:
    - BOT_YOUNG_TOKEN=${BOT_YOUNG_TOKEN}
    - SERVER_HOST=http://server:8000
    - API_SECRET_KEY=${API_SECRET_KEY}
  networks:
    - app-network
  restart: unless-stopped
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π celery-worker

```yaml
celery-worker:
  build:
    context: ./server
    dockerfile: Dockerfile
  # –î–æ–±–∞–≤–ª—è–µ–º digest_queue –∫ —Å–ø–∏—Å–∫—É –æ—á–µ—Ä–µ–¥–µ–π
  command: celery -A app.core.celery_app worker --loglevel=info 
           --queues=sync_queue,alerts_queue,export_queue,digest_queue
  depends_on:
    db:
      condition: service_healthy
    redis:
      condition: service_healthy
  environment:
    - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
    - REDIS_URL=redis://redis:6379/0
    - SYNC_INTERVAL=${SYNC_INTERVAL}
    - SYNC_DAYS=${SYNC_DAYS}
    - STOCK_ALERT_CHECK_TIME=${STOCK_ALERT_CHECK_TIME}
    - STOCK_ALERT_COOLDOWN_HOURS=${STOCK_ALERT_COOLDOWN_HOURS}
    - BOT_YOUNG_TOKEN=${BOT_YOUNG_TOKEN}  # NEW! –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  networks:
    - app-network
```

**–í–∞–∂–Ω–æ:** 
- –ù–µ –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `bot_young_celery` –∏ `bot_young_beat`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `celery-worker` –∏ `celery-beat`
- –î–æ–±–∞–≤–∏–ª–∏ `BOT_YOUNG_TOKEN` –≤ environment celery-worker –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (Post-MVP)

### –§–∞–∑–∞ 2: –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
- –í—ã–±–æ—Ä –±–ª–æ–∫–æ–≤ –¥–ª—è —Å–≤–æ–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã, —Ç–æ–ª—å–∫–æ –æ—Å—Ç–∞—Ç–∫–∏ –∏ —Ç.–¥.)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–∞ –¥–ª—è "–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤"
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ (—á–µ—Ä–µ–∑ Plotly)

### –§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π/–º–µ—Å—è—Ü–µ–º
- –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
- AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GPT —Å–µ—Ä–≤–∏—Å–æ–º)

### –§–∞–∑–∞ 4: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ö–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- Deep links –≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–≤–æ–¥–∫—É –≤—Ä—É—á–Ω—É—é (`/digest` –≤ –∫–∞–Ω–∞–ª–µ)

### –§–∞–∑–∞ 5: –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–∑—ã–∫–∞ —Å–≤–æ–¥–æ–∫

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### FAQ

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª?**
A: 
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ ‚Üí "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–º"
3. –†–∞–∑–¥–µ–ª "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã" ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
4. –ù–∞–π–¥–∏—Ç–µ @wb_assist_young_bot
5. –í–∫–ª—é—á–∏—Ç–µ –ø—Ä–∞–≤–∞ "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π"

**Q: –ú–æ–∂–Ω–æ –ª–∏ –ø–æ–ª—É—á–∞—Ç—å —Å–≤–æ–¥–∫–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è?**
A: –ù–µ—Ç, —ç—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤ –∏ –≥—Ä—É–ø–ø. –î–ª—è –ª–∏—á–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞.

**Q: –°–≤–æ–¥–∫–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ –≤–æ–≤—Ä–µ–º—è**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ú–°–ö (UTC+3).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–¥–∫–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤?**
A: –î–∞! –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–Ω—Ü–∏–ø—ã
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–∞–Ω–∞–ª—ã –∏ –∫–∞–±–∏–Ω–µ—Ç—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã:** BOT_TOKEN –∏ API_SECRET_KEY —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ .env
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞:** –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –∫–∞–Ω–∞–ª—ã, –≥–¥–µ –æ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ
–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–≤–æ–¥–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ö–∞–Ω–∞–ª –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ë–æ—Ç –≤—Å–µ –µ—â–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (is_active=True)
4. –ö–∞–±–∏–Ω–µ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞

### bot_young/ (–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å)

```
bot_young/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ __main__.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∑–∞–≥—Ä—É–∑–∫–∞ .env)
‚îÇ   ‚îî‚îÄ‚îÄ states.py            # FSM States –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ start.py             # /start, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ channels.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ add_channel.py       # FSM: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
‚îÇ   ‚îî‚îÄ‚îÄ settings.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.py         # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ client.py            # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ server API
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ validators.py        # –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤, –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç.–¥.
‚îÇ   ‚îî‚îÄ‚îÄ formatters.py        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

### server/app/features/digest/ (–Ω–æ–≤—ã–π feature –≤ server)

```
server/app/features/digest/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ models.py                # ChannelReport, DigestHistory
‚îú‚îÄ‚îÄ schemas.py               # Pydantic —Å—Ö–µ–º—ã –¥–ª—è API
‚îú‚îÄ‚îÄ crud.py                  # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤
‚îú‚îÄ‚îÄ service.py               # DigestService - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ formatter.py             # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–¥–æ–∫ –¥–ª—è Telegram
‚îú‚îÄ‚îÄ tasks.py                 # Celery –∑–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ (NEW!)
‚îî‚îÄ‚îÄ router.py                # FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```

**–í–∞–∂–Ω–æ:** Celery –∑–∞–¥–∞—á–∏ —Ç–µ–ø–µ—Ä—å –≤ `server/`, –∞ –Ω–µ –≤ `bot_young/`!

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### Backend
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –°–µ—Ä–≤–∏—Å —Å–±–æ—Ä–∞ —Å–≤–æ–¥–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Bot
- [ ] –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø–æ–ª—É—á–µ–Ω –æ—Ç @BotFather
- [ ] .env —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Celery –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Redis
- [ ] Beat scheduler –∑–∞–ø—É—â–µ–Ω

### Infrastructure
- [ ] Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] Docker –æ–±—Ä–∞–∑—ã —Å–æ–±—Ä–∞–Ω—ã
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### Testing
- [ ] Unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] E2E flow –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é
- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `/Users/core/code/wb_assist`

**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: `bot/`
- Backend: `server/`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/`

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `docs/project/SPEC_TECH.md`
- –°—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `docs/stages/`

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-11-07*  
*–°—Ç–∞—Ç—É—Å: –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞, –æ–∂–∏–¥–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏*  
*–ê–≤—Ç–æ—Ä: WB Assist Development Team*

