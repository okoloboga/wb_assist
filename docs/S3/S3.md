# üìò –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —ç—Ç–∞–ø–∞ 3: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –û–ë–©–ò–ô –ü–†–û–¶–ï–°–° –†–ê–ë–û–¢–´

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ /start –∏ —Å–∏—Å—Ç–µ–º–∞ –µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤ –ë–î –ø–æ telegram_id
- –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–≤–µ—Å—Ç–∏ WB API - –±–µ–∑ –∫–ª—é—á–∞ –Ω–µ–ª—å–∑—è –ø–æ–ø–∞—Å—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç WB API - –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏ –≤ —Å–ª—É—á–∞–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ü–æ–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç –æ–∫–æ–Ω—á–µ–Ω–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é. –í–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–∏—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º—ã –ø–æ–ª—É—á–∞–µ–º –æ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ WB –¥–∞–Ω–Ω—ã–µ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
- –ö–æ–≥–¥–∞ –ü–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–∫–æ–Ω—á–µ–Ω–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (webhook - –±–æ—Ç —à–ª—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ù–ï –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ö–∞–∂–¥—ã–µ {SYNC_INTERVAL} —Å–µ–∫—É–Ω–¥ Celery –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ: –ó–∞–∫–∞–∑—ã, –í—ã–∫—É–ø—ã, –û—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤, –í–æ–∑–≤—Ä–∞—Ç—ã, –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã, –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö - —Å–µ—Ä–≤–µ—Ä –ø–æ Webhook –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –æ–± —ç—Ç–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ï—Å–ª–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ - –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∏–¥—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

## üîÑ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò

1. **Celery Beat** –∑–∞–ø—É—Å–∫–∞–µ—Ç `sync_all_cabinets()` –∫–∞–∂–¥—ã–µ `SYNC_INTERVAL` —Å–µ–∫—É–Ω–¥
                          ‚Üì
2. **sync_cabinet_data()** –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
                          ‚Üì
3. **–í sync_all_data():**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `previous_sync_at = cabinet.last_sync_at`
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å WB API (flag=0 –¥–ª—è sales)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `process_sync_events_simple()`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `cabinet.last_sync_at = now()`
   - –ö–æ–º–º–∏—Ç –≤ –ë–î
                          ‚Üì
4. **–í process_sync_events_simple():**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `previous_sync_at` –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –í—ã–∫—É–ø—ã/–≤–æ–∑–≤—Ä–∞—Ç—ã –∏—â—É—Ç—Å—è –ø–æ `created_at > previous_sync_at` (–≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ë–î)
   - –ó–∞–∫–∞–∑—ã/–æ—Ç–º–µ–Ω—ã –∏—â—É—Ç—Å—è –ø–æ `created_at/updated_at > previous_sync_at`
   - –§–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–≤–∞—Ä–∞—Ö
                          ‚Üì
5. **Webhook –æ—Ç–ø—Ä–∞–≤–∫–∞:**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ HTTP POST webhook
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `NotificationHistory` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                          ‚Üì
6. **–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç webhook** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### **1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã**
- **Webhook —Å–∏—Å—Ç–µ–º–∞** - —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–æ—Ç—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ webhook
- **–ï–¥–∏–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ WB —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ –ë–î —á–µ—Ä–µ–∑ Celery
- **Event-driven —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–ú—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞–±–∏–Ω–µ—Ç—ã** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–∏–Ω API –∫–ª—é—á
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `created_at`/`updated_at` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- **–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è sales** - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `flag=0` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

### **2. –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã** - —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- **–í—ã–∫—É–ø—ã** - —Å–æ–±—ã—Ç–∏—è –≤—ã–∫—É–ø–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **–û—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤** - –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–≤–∞—Ä–µ
- **–í–æ–∑–≤—Ä–∞—Ç—ã** - —Å–æ–±—ã—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã** - –æ—Ç–∑—ã–≤—ã —Å –æ—Ü–µ–Ω–∫–æ–π 1-3 –∑–≤–µ–∑–¥—ã
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏** - —Ç–æ–≤–∞—Ä—ã —Å –æ—Å—Ç–∞—Ç–∫–æ–º ‚â§ 2 —à—Ç—É–∫

### **3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–ø–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É

### **4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- **Timezone –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `TimezoneUtils` –¥–ª—è –µ–¥–∏–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ú–°–ö (UTC+3)
- **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç** - WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ú–°–ö, –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ –ú–°–ö, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ UTC –¥–ª—è –ë–î
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏** - UTC –∏–∑ –ë–î –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –ú–°–ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Rate limiting** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 429 –æ—à–∏–±–æ–∫ —Å `Retry-After` –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
- **Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã** - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π exponential backoff –¥–æ 5 –º–∏–Ω—É—Ç –¥–ª—è "sales" API
- **Image support** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- **Duplicate prevention** - –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ `NotificationHistory`
- **Smart stock detection** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ–∂—Å–∫–ª–∞–¥—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö

### **5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **WBOrder** - –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ (–Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ `created_at`, –æ—Ç–º–µ–Ω—ã —á–µ—Ä–µ–∑ `updated_at`)
- **WBSales** - —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–¥–∞–∂/–≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (–≤—ã–∫—É–ø—ã/–≤–æ–∑–≤—Ä–∞—Ç—ã —á–µ—Ä–µ–∑ `created_at` - –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ë–î)
- **WBReview** - –æ—Ç–∑—ã–≤—ã (–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ `created_date`)
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–æ–º–µ–Ω–∞–º** - –∑–∞–∫–∞–∑—ã ‚â† —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- **–õ–æ–≥–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏** - `created_at` –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π, `updated_at` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   WB API        ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Sync Service    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Database      ‚îÇ
‚îÇ   (Wildberries) ‚îÇ    ‚îÇ  (Celery Tasks)  ‚îÇ    ‚îÇ   (PostgreSQL)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Bot           ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ  Webhook API     ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ Notification   ‚îÇ
‚îÇ   (Telegram)    ‚îÇ    ‚îÇ  (HTTP POST)     ‚îÇ    ‚îÇ Service         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ –§–ª–æ—É —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### **1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- **Celery Beat** –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ `SYNC_INTERVAL` —Å–µ–∫—É–Ω–¥
- **WBSyncService** –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ WB API
- **Sales API** –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `flag=0` (–ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è) –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Å –º–µ—Ç–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏ (`created_at`, `updated_at`)
- –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ `WBSyncLog` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- **Timezone:** WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ú–°–ö, –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ –ú–°–ö, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ UTC –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

### **2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π**
- **NotificationService** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –ø—Ä—è–º—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã, –≤—ã–∫—É–ø—ã, –æ—Ç–º–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `created_at`/`updated_at` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ `last_sync_at` (–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
- **–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –≤—ã–∫—É–ø—ã/–≤–æ–∑–≤—Ä–∞—Ç—ã –∏—â—É—Ç—Å—è –ø–æ `created_at` (–≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ë–î), –∞ –Ω–µ –ø–æ `sale_date` (–≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è)

### **3. Webhook —Å–∏—Å—Ç–µ–º–∞**
- **NotificationService** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTTP POST webhook
- **Bot** –ø–æ–ª—É—á–∞–µ—Ç webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Bot** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram
- **WebhookSender** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç retry –ª–æ–≥–∏–∫—É –∏ –æ—à–∏–±–∫–∏

### **4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **NotificationService** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –ø—Ä—è–º—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏
- **EventDetector** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
- **NotificationGenerator** —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–≤–∞—Ä–µ
- **BotMessageFormatter** —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
- **Bot** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
- **WebhookSender** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ HTTP POST
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `NotificationHistory`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### **Backend (Server)**
```
server/app/features/notifications/
‚îú‚îÄ‚îÄ notification_service.py      # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
‚îú‚îÄ‚îÄ event_detector.py           # –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ notification_generator.py   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ models.py                   # –ú–æ–¥–µ–ª–∏ –ë–î
‚îú‚îÄ‚îÄ crud.py                     # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ schemas.py                  # Pydantic —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ webhook_sender.py           # Webhook –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

server/app/features/wb_api/
‚îú‚îÄ‚îÄ sync_service.py             # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å WB (flag=0 –¥–ª—è sales)
‚îú‚îÄ‚îÄ models.py                   # –ú–æ–¥–µ–ª–∏ WB –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models_sales.py             # –ú–æ–¥–µ–ª—å WBSales
‚îú‚îÄ‚îÄ client.py                   # WB API –∫–ª–∏–µ–Ω—Ç
‚îî‚îÄ‚îÄ crud_cabinet_users.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏

server/app/utils/
‚îî‚îÄ‚îÄ timezone.py                 # TimezoneUtils –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ú–°–ö/UTC
```

### **Frontend (Bot)**
```
bot/handlers/
‚îú‚îÄ‚îÄ webhook.py                  # Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ notifications.py            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ orders.py                   # –ö–æ–º–∞–Ω–¥—ã –∑–∞–∫–∞–∑–æ–≤
‚îî‚îÄ‚îÄ commands.py                 # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
```

### **Sync Service**
```
server/app/features/sync/
‚îú‚îÄ‚îÄ tasks.py                    # Celery –∑–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ wb_sync_integration.py      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**
- `wb_orders` - –∑–∞–∫–∞–∑—ã WB (–Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã, –æ—Ç–º–µ–Ω—ã)
- `wb_sales` - —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–¥–∞–∂/–≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (–≤—ã–∫—É–ø—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã)
- `wb_products` - —Ç–æ–≤–∞—Ä—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- `wb_stocks` - –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `wb_reviews` - –æ—Ç–∑—ã–≤—ã (–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã)
- `wb_sync_logs` - –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `notification_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `notification_history` - –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `cabinet_users` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏

### **–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è**
- `WBOrder.created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ –ë–î
- `WBOrder.updated_at` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- `WBSales.created_at` - –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –≤ –ë–î
- `WBSales.sale_date` - –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –ø–æ WB (–≤ UTC)
- `WBSales.type` - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è ('buyout', 'return')
- `WBReview.created_date` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞
- `WBProduct.image_url` - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
- `WBSyncLog.completed_at` - –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `NotificationSettings.notifications_enabled` - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **Environment Variables**
```env
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª (—Å–µ–∫—É–Ω–¥—ã)
SYNC_INTERVAL=180

# WB API rate limits
WB_API_RATE_LIMIT=30  # requests per minute
WB_API_INTERVAL=2000   # ms between requests

# Database
POSTGRES_USER=user
POSTGRES_PASSWORD=password
POSTGRES_DB=wb_assist_db

# Redis
REDIS_URL=redis://localhost:6379/0

# Bot
BOT_TOKEN=your_telegram_bot_token
WEBHOOK_URL=https://your-domain.com/webhook
```

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ (`notifications_enabled`)
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–ø–∞–º:
  - `new_orders_enabled` - –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
  - `order_buyouts_enabled` - –≤—ã–∫—É–ø—ã
  - `order_cancellations_enabled` - –æ—Ç–º–µ–Ω—ã
  - `order_returns_enabled` - –≤–æ–∑–≤—Ä–∞—Ç—ã
  - `negative_reviews_enabled` - –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
  - `critical_stocks_enabled` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π –≤ —á–∞—Å
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å API –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π (–∑–∞–∫–∞–∑—ã, –≤—ã–∫—É–ø—ã, –æ—Ç–º–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã, –æ—Ç–∑—ã–≤—ã)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: `WBSyncLog` —Ç–∞–±–ª–∏—Ü–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: `NotificationHistory` —Ç–∞–±–ª–∏—Ü–∞
- –û—à–∏–±–∫–∏: Application logs —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –∫–∞–±–∏–Ω–µ—Ç–∞–º

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- –õ–æ–≥–∏ Celery Worker –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –õ–æ–≥–∏ Bot –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è WB API

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- PostgreSQL 15+
- Redis 6+
- Python 3.12+
- Celery —Å Redis broker

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- **Server** - FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **Celery Worker** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **Celery Beat** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (–∫–∞–∂–¥—ã–µ SYNC_INTERVAL —Å–µ–∫—É–Ω–¥)
- **Bot** - Telegram –±–æ—Ç —Å webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫—ç—à –∏ –±—Ä–æ–∫–µ—Ä –¥–ª—è Celery

### **Docker Compose**
```yaml
services:
  server:
    build: ./server
    ports:
      - "8000:8000"
    environment:
      - SYNC_INTERVAL=180
      - POSTGRES_URL=postgresql://user:password@postgres:5432/wb_assist_db
      - REDIS_URL=redis://redis:6379/0
  
  celery-worker:
    build: ./server
    command: celery -A app.core.celery_app worker --loglevel=info
    environment:
      - SYNC_INTERVAL=180
  
  celery-beat:
    build: ./server
    command: celery -A app.core.celery_app beat --loglevel=info
    environment:
      - SYNC_INTERVAL=180
  
  bot:
    build: ./bot
    environment:
      - BOT_TOKEN=your_telegram_bot_token
      - WEBHOOK_URL=https://your-domain.com/webhook
  
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=wb_assist_db
  
  redis:
    image: redis:7-alpine
```

