

–ó–∞–∫–∞–∑—ã

Order ID: 2452 ‚úì
WB Order ID: 96932207636229823973
NM ID (—Ç–æ–≤–∞—Ä): 317313124 ‚úì
–ù–∞–∑–≤–∞–Ω–∏–µ: –Æ–±–∫–∏ ‚úì
–ë—Ä–µ–Ω–¥: SLAVALOOK BRAND ‚úì
–ê—Ä—Ç–∏–∫—É–ª: slavalookbrand_shorts_skirt_vinous
–†–∞–∑–º–µ—Ä: L ‚úì
–®—Ç—Ä–∏—Ö–∫–æ–¥: 2042583874119 ‚úì
–°—Ç–∞—Ç—É—Å: active ‚úì
üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
–¶–µ–Ω–∞ –∑–∞–∫–∞–∑–∞: 3000.0‚ÇΩ ‚úì
–°–ü–ü %: 27.0% ‚úì
–¶–µ–Ω–∞ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è: 571.0‚ÇΩ ‚úì
–ö–æ–º–∏—Å—Å–∏—è: 20.0%
–°–∫–∏–¥–∫–∞: 74.0%
üè¢ –õ–æ–≥–∏—Å—Ç–∏–∫–∞:
–°–∫–ª–∞–¥ –æ—Ç: –†—è–∑–∞–Ω—å (–¢—é—à–µ–≤—Å–∫–æ–µ) ‚úì
–°–∫–ª–∞–¥ –∫: –ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å ‚úì
–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞: 2025-10-23 04:56:41+00:00 ‚úì

‚≠ê –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã:
–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: 4.69 (–∏–∑ WBReview) vs 0.0 (–≤ –ª–æ–≥–µ)
–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤: 26 ‚úì
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤:
5 –∑–≤–µ–∑–¥: 21 –æ—Ç–∑—ã–≤
4 –∑–≤–µ–∑–¥—ã: 3 –æ—Ç–∑—ã–≤–∞
3 –∑–≤–µ–∑–¥—ã: 1 –æ—Ç–∑—ã–≤
2 –∑–≤–µ–∑–¥—ã: 1 –æ—Ç–∑—ã–≤

üì¶ –û—Å—Ç–∞—Ç–∫–∏ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º:
L: 2 —à—Ç. ‚úì
XL: 18 —à—Ç.
M: 0 —à—Ç.

üìà –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã:
–ó–∞ 7 –¥–Ω–µ–π: 4 –ø—Ä–æ–¥–∞–∂–∏
–ó–∞ 14 –¥–Ω–µ–π: 4 –ø—Ä–æ–¥–∞–∂–∏
–ó–∞ 30 –¥–Ω–µ–π: 4 –ø—Ä–æ–¥–∞–∂–∏

üîç –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º:
–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 38
–ê–∫—Ç–∏–≤–Ω—ã–µ: 21 –∑–∞–∫–∞–∑
–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ: 17 –∑–∞–∫–∞–∑–æ–≤

–ò–°–¢–û–ß–ù–ò–ö–ò

## üìã **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–µ**

### üóÑÔ∏è **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

#### 1. **`WBOrder`** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞
SELECT id, order_id, nm_id, status, name, brand, article, size, 
       barcode, total_price, spp_percent, customer_price, 
       logistics_amount, warehouse_from, warehouse_to, 
       order_date, created_at, updated_at, cabinet_id
FROM wb_orders 
WHERE nm_id = 317313124;
```

#### 2. **`WBReview`** - –æ—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏
```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–∑—ã–≤–∞–º
SELECT 
    AVG(rating) as avg_rating,
    COUNT(*) as total_reviews,
    rating,
    COUNT(*) as rating_count
FROM wb_reviews 
WHERE nm_id = 317313124
GROUP BY rating
ORDER BY rating;
```

#### 3. **`WBStock`** - –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
```sql
-- –û—Å—Ç–∞—Ç–∫–∏ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º –∏ —Å–∫–ª–∞–¥–∞–º
SELECT size, warehouse_name, quantity, updated_at
FROM wb_stocks 
WHERE nm_id = 317313124
ORDER BY size, warehouse_name;
```

#### 4. **`WBSales`** - –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã
```sql
-- –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã
SELECT 
    COUNT(*) as sales_7_days
FROM wb_sales 
WHERE nm_id = 317313124 
  AND sale_date >= NOW() - INTERVAL '7 days';
```

### üêç **Python –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**

#### **1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```python
import sys
sys.path.append('/app')
from app.core.database import get_db
from app.features.wb_api.models import WBOrder, WBProduct, WBStock, WBReview, WBSales
from sqlalchemy.orm import Session
from sqlalchemy import func

db = next(get_db())
```

#### **2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞:**
```python
# –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ –ø–æ ID
order = db.query(WBOrder).filter(WBOrder.id == 2452).first()

# –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ –ø–æ NM ID
orders = db.query(WBOrder).filter(WBOrder.nm_id == 317313124).all()
```

#### **3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –æ—Ç–∑—ã–≤–æ–≤:**
```python
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–∑—ã–≤–∞–º
reviews_stats = db.query(
    func.avg(WBReview.rating).label('avg_rating'),
    func.count(WBReview.id).label('total_reviews')
).filter(WBReview.nm_id == 317313124).first()

# –í—Å–µ –æ—Ç–∑—ã–≤—ã —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥–∞–º
reviews = db.query(WBReview).filter(WBReview.nm_id == 317313124).all()
```

#### **4. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤:**
```python
# –û—Å—Ç–∞—Ç–∫–∏ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º
stocks = db.query(WBStock).filter(WBStock.nm_id == 317313124).all()

# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º
stock_by_size = {}
for stock in stocks:
    size = stock.size or '–ë–µ–∑ —Ä–∞–∑–º–µ—Ä–∞'
    if size not in stock_by_size:
        stock_by_size[size] = 0
    stock_by_size[size] += stock.quantity or 0
```

#### **5. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã:**
```python
from datetime import datetime, timedelta

# –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ 7 –¥–Ω–µ–π
seven_days_ago = datetime.utcnow() - timedelta(days=7)
sales_7_days = db.query(WBSales).filter(
    WBSales.nm_id == 317313124,
    WBSales.sale_date >= seven_days_ago
).count()
```

### üê≥ **Docker –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

#### **1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python —Å–∫—Ä–∏–ø—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:**
```bash
docker exec $(docker ps -q --filter "name=server") python -c "
# –í–∞—à Python –∫–æ–¥ –∑–¥–µ—Å—å
"
```

#### **2. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:**
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker exec -it $(docker ps -q --filter "name=server") psql -U postgres -d wb_assist

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT * FROM wb_orders WHERE nm_id = 317313124;
```

### üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞:**
```python
order_data = {
    "id": order.id,
    "order_id": order.order_id,
    "nm_id": order.nm_id,
    "status": order.status,
    "name": order.name,
    "brand": order.brand,
    "article": order.article,
    "size": order.size,
    "barcode": order.barcode,
    "total_price": order.total_price,
    "spp_percent": order.spp_percent,
    "customer_price": order.customer_price,
    "logistics_amount": order.logistics_amount,
    "warehouse_from": order.warehouse_from,
    "warehouse_to": order.warehouse_to,
    "order_date": order.order_date.isoformat() if order.order_date else None
}
```

#### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```python
# –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
rating_data = {
    "avg_rating": reviews_stats.avg_rating,
    "total_reviews": reviews_stats.total_reviews
}

# –û—Å—Ç–∞—Ç–∫–∏
stocks_data = {
    size: quantity for size, quantity in stock_by_size.items()
}

# –ü—Ä–æ–¥–∞–∂–∏
sales_data = {
    "sales_7_days": sales_7_days,
    "sales_14_days": sales_14_days,
    "sales_30_days": sales_30_days
}
```

### üîß **–ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã:**

#### **1. –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ:**
```sql
SELECT 
    o.*,
    p.rating as product_rating,
    p.reviews_count as product_reviews_count
FROM wb_orders o
LEFT JOIN wb_products p ON o.nm_id = p.nm_id
WHERE o.id = 2452;
```

#### **2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä—É:**
```sql
SELECT 
    o.nm_id,
    COUNT(o.id) as total_orders,
    COUNT(CASE WHEN o.status = 'active' THEN 1 END) as active_orders,
    COUNT(CASE WHEN o.status = 'canceled' THEN 1 END) as canceled_orders,
    AVG(r.rating) as avg_rating,
    COUNT(r.id) as total_reviews
FROM wb_orders o
LEFT JOIN wb_reviews r ON o.nm_id = r.nm_id
WHERE o.nm_id = 317313124
GROUP BY o.nm_id;
```

### üìù **–ò—Ç–æ–≥–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**

```python
def get_order_detailed_info(order_id: int):
    db = next(get_db())
    
    # 1. –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–∫–∞–∑
    order = db.query(WBOrder).filter(WBOrder.id == order_id).first()
    
    # 2. –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
    reviews_stats = db.query(
        func.avg(WBReview.rating).label('avg_rating'),
        func.count(WBReview.id).label('total_reviews')
    ).filter(WBReview.nm_id == order.nm_id).first()
    
    # 3. –û—Å—Ç–∞—Ç–∫–∏
    stocks = db.query(WBStock).filter(WBStock.nm_id == order.nm_id).all()
    
    # 4. –ü—Ä–æ–¥–∞–∂–∏
    sales_7_days = db.query(WBSales).filter(
        WBSales.nm_id == order.nm_id,
        WBSales.sale_date >= datetime.utcnow() - timedelta(days=7)
    ).count()
    
    return {
        "order": order,
        "rating": reviews_stats.avg_rating,
        "reviews_count": reviews_stats.total_reviews,
        "stocks": stocks,
        "sales_7_days": sales_7_days
    }
```

–≠—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –º–µ—Ç–æ–¥—ã –ø–æ–∑–≤–æ–ª—è—Ç –≤–∞–º –ø–æ–ª—É—á–∞—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–∞—Ö –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º! üéØ