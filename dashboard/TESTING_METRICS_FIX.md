# Тестирование исправления динамики метрик

## Что было исправлено
Исправлена проблема с отображением графиков динамики метрик в дашборде.

## Как проверить

### 1. Запустить дашборд
```bash
cd dashboard
npm install
npm run dev
```

### 2. Открыть в браузере
```
http://localhost:5173
```

### 3. Проверить консоль браузера (F12)
Не должно быть ошибок типа:
- ❌ `Cannot read property 'daily_data' of undefined`
- ❌ `Cannot read property 'purchases' of undefined`

### 4. Проверить отображение графиков

#### Карточки метрик (вверху страницы)
Должны отображаться 4 карточки с числами:
- ✅ **Заказы** - общее количество заказов за период
- ✅ **Выкупы** - количество выкупленных заказов
- ✅ **Отмены** - количество отмененных заказов
- ✅ **Возвраты** - количество возвратов

#### График "Динамика метрик"
Должен отображаться график с 4 линиями:
- ✅ **Синяя линия** - Заказы
- ✅ **Зеленая линия** - Выкупы
- ✅ **Оранжевая линия** - Отмены
- ✅ **Красная линия** - Возвраты

#### Кнопки переключения метрик
Над графиком должны быть 4 кнопки:
- ✅ Клик по кнопке скрывает/показывает соответствующую линию
- ✅ Иконка глаза меняется на перечеркнутый глаз при скрытии

### 5. Проверить переключение периодов
Вверху страницы есть кнопки периодов:
- ✅ 30 дней
- ✅ 60 дней
- ✅ 90 дней
- ✅ 180 дней

При переключении:
- ✅ Карточки метрик обновляются
- ✅ График обновляется с новыми данными
- ✅ Нет ошибок в консоли

### 6. Проверить API запросы

Открыть вкладку Network (F12 → Network):

#### Запрос к `/api/v1/bot/analytics/summary`
```json
{
  "success": true,
  "summary": {
    "orders": 1350,
    "purchases": 1140,
    "cancellations": 150,
    "returns": 60
  },
  "period": {
    "start": "2025-10-28",
    "end": "2025-11-27",
    "days": 30
  }
}
```

#### Запрос к `/api/v1/bot/analytics/daily-trends`
```json
{
  "status": "success",
  "analytics": {
    "meta": {
      "days_window": 30,
      "date_range": {
        "start": "2025-10-28",
        "end": "2025-11-26"
      }
    },
    "time_series": [
      {
        "date": "2025-10-28",
        "orders": 45,
        "buyouts": 38,
        "cancellations": 5,
        "returns": 2,
        "avg_rating": 4.5
      }
    ]
  }
}
```

## Возможные проблемы

### График не отображается
1. Проверьте консоль на ошибки
2. Убедитесь, что API возвращает данные в правильном формате
3. Проверьте, что `time_series` не пустой массив

### Данные не обновляются при смене периода
1. Проверьте Network вкладку - идут ли запросы к API
2. Убедитесь, что React Query не кэширует старые данные
3. Попробуйте обновить страницу (F5)

### Неправильные значения на графике
1. Проверьте, что бэкенд возвращает `buyouts`, а не `purchases` в `time_series`
2. Убедитесь, что фронтенд маппит `buyouts` → `purchases` для отображения

## Дата тестирования
27 ноября 2025
