"""
Модуль для генерации промптов карточек товаров через GPT.
"""

from typing import Dict


def create_card_prompt(
    characteristics: Dict[str, str],
    target_audience: str,
    selling_points: str,
    semantic_core_text: str = None
) -> str:
    """
    Создает промпт для GPT на основе данных о товаре.
    
    Args:
        characteristics: Характеристики товара (name, brand, category)
        target_audience: Описание целевой аудитории
        selling_points: Уникальные преимущества товара
        semantic_core_text: Опциональный текст семантического ядра
        
    Returns:
        str: Готовый промпт для GPT
    """
    
    semantic_core_section = ""
    if semantic_core_text:
        semantic_core_section = f"""
СЕМАНТИЧЕСКОЕ ЯДРО:
Проанализируй предоставленное семантическое ядро, которое было собрано у конкурентов. Используй эти ключевые слова, фразы, преимущества и сценарии использования, чтобы сделать генерируемый текст максимально полным и продающим.
---
{semantic_core_text}
---
"""

    prompt = f"""Создай привлекательную карточку товара для Wildberries на основе следующих данных:

ХАРАКТЕРИСТИКИ ТОВАРА:
• Название: {characteristics.get('name', 'Не указано')}
• Бренд: {characteristics.get('brand', 'Не указано')}
• Категория: {characteristics.get('category', 'Не указано')}

ЦЕЛЕВАЯ АУДИТОРИЯ:
{target_audience}

УНИКАЛЬНЫЕ ПРЕИМУЩЕСТВА:
{selling_points}
{semantic_core_section}
Создай карточку товара, которая включает:

1. ЗАГОЛОВОК ТОВАРА
   - Привлекательный, SEO-оптимизированный
   - Включает ключевые слова для поиска
   - Не более 60 символов
   - Подчеркивает уникальность товара

2. ОПИСАНИЕ ТОВАРА
   - Детальное, убедительное описание
   - Подчеркивает преимущества
   - Обращается к целевой аудитории
   - Структурированное, с абзацами
   - Длина: 500-1000 символов
   - Используй эмодзи для визуального разделения секций (не более 2-3 на описание)

3. КЛЮЧЕВЫЕ ХАРАКТЕРИСТИКИ
   - Структурированный список важных параметров товара
   - Формат: "• Характеристика: значение"
   - 5-7 ключевых характеристик

4. ПРЕИМУЩЕСТВА ДЛЯ ПОКУПАТЕЛЯ
   - Уникальные selling points в формате маркированного списка
   - Преимущества перед конкурентами
   - Конкретные выгоды для покупателя

5. РЕКОМЕНДАЦИИ ПО ПОЗИЦИОНИРОВАНИЮ (опционально)
   - Ключевые слова для SEO
   - Советы по маркетингу

ВАЖНО:
- Текст должен быть готов для использования в карточке товара на Wildberries
- Избегай маркетинговых клише, будь конкретным
- Используй естественный, понятный язык
- Структурируй информацию для легкого чтения
- Не используй Markdown форматирование (экранные символы), только обычный текст с эмодзи

Верни результат в структурированном формате, готовом для отправки пользователю."""
    
    return prompt


def format_card_response(gpt_response: str) -> str:
    """
    Форматирует ответ GPT для отправки в Telegram.
    
    Args:
        gpt_response: Ответ от GPT
        
    Returns:
        str: Отформатированный текст карточки
    """
    # Убираем лишние пробелы и переносы в начале/конце
    formatted = gpt_response.strip()
    
    # Если ответ пустой, возвращаем заглушку
    if not formatted:
        return "❌ Не удалось сгенерировать карточку. Попробуйте еще раз."
    
    return formatted

