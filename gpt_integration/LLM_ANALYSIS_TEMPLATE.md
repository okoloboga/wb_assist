# LLM –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äî –¢–ó –∏ —à–∞–±–ª–æ–Ω

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è LLM‚Äë–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ e‚Äëcommerce –¥–∞–Ω–Ω—ã—Ö (WB):
- –°–µ–∫—Ü–∏—è `SYSTEM` –∑–∞–¥–∞—ë—Ç –æ–±—â—É—é —Ä–æ–ª—å –∏ —Å—Ç–∏–ª—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.
- –°–µ–∫—Ü–∏—è `TASKS` –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –º—ã—Å–ª–∏.
- –°–µ–∫—Ü–∏—è `OUTPUT_JSON_SCHEMA` –∑–∞–¥–∞—ë—Ç —Å—Ç—Ä–æ–≥–∏–π JSON‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
- –°–µ–∫—Ü–∏—è `OUTPUT_TG_GUIDE` —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç —á–µ–ª–æ–≤–µ–∫–æ‚Äë—á–∏—Ç–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è Telegram.

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ —Å–µ–∫—Ü–∏–∏ –≤ `gpt_integration.pipeline.compose_messages`, –æ–±—ä–µ–¥–∏–Ω—è—è –∏—Ö —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (`data`) –∏ —Ç—Ä–µ–±—É—è –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## SYSTEM
–¢—ã –∞–Ω–∞–ª–∏—Ç–∏–∫ e‚Äëcommerce (Wildberries). –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É, –∏–∑–±–µ–≥–∞–π ¬´–≤–æ–¥—ã¬ª. –°–æ–±–ª—é–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É JSON. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —è–≤–Ω–æ –æ—Ç–º–µ—á–∞–π —ç—Ç–æ –≤ `anomalies` –∏ –¥–∞–≤–∞–π –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —É–∫–∞–∑—ã–≤–∞—è –¥–æ–ø—É—â–µ–Ω–∏—è. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –°—Ä–∞–≤–Ω–∏–≤–∞–π –¥–∏–Ω–∞–º–∏–∫—É (–¥–µ–Ω—å –∫ –¥–Ω—é, –Ω–µ–¥–µ–ª—è –∫ –Ω–µ–¥–µ–ª–µ), –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç.
- –£—á–∏—Ç—ã–≤–∞–π —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —è–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.
- –ò–∑–±–µ–≥–∞–π –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã.

---

## TASKS
–ó–∞–¥–∞—á–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ü—Ä–∏–º–µ–Ω—è–π —Ç–µ –ø—É–Ω–∫—Ç—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ–∫—Ü–∏–∏ `DATA`.

1) –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (key_metrics)
- –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞: `date_range.start_date`, `date_range.end_date` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã).
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
  - `orders_count`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤.
  - `revenue_rub`: –≤—ã—Ä—É—á–∫–∞ (–≤ ‚ÇΩ).
  - `avg_order_value`: —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ (‚ÇΩ), –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞.
- –î–∏–Ω–∞–º–∏–∫–∞ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç):
  - `day_over_day` (%): –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¥–Ω—é.
  - `week_over_week` (%): –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏:
  - `top_products_count`: —á–∏—Å–ª–æ SKU/—Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç–æ–ø‚Äë–ø—Ä–æ–¥–∞–∂–∞—Ö.
  - `critical_stocks_count`: —á–∏—Å–ª–æ –ø–æ–∑–∏—Ü–∏–π —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º.

2) –ê–Ω–æ–º–∞–ª–∏–∏ (anomalies)
- –§–∏–∫—Å–∏—Ä—É–π —Ä–µ–∑–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–∫–∞—á–∫–∏/–ø–∞–¥–µ–Ω–∏—è) –≤ –∑–∞–∫–∞–∑–∞—Ö/–≤—ã—Ä—É—á–∫–µ.
- –í—ã—è–≤–ª—è–π –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç–æ–∫–æ–º: –Ω—É–ª–µ–≤—ã–µ –∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏.
- –û—Ç–º–µ—á–∞–π –≤—Å–ø–ª–µ—Å–∫–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.
- –î–ª—è –∫–∞–∂–¥–æ–π –∞–Ω–æ–º–∞–ª–∏–∏ —É–∫–∞–∑—ã–≤–∞–π:
  - `type`: –æ–¥–Ω–æ —Å–ª–æ–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `stockout`, `revenue_drop`, `negative_reviews_spike`)
  - `description`: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.
  - `severity`: `low` | `medium` | `high` (–ø–æ —Ç–≤–æ–µ–π –æ—Ü–µ–Ω–∫–µ –≤–ª–∏—è–Ω–∏—è).
  - `affected_items`: –º–∞—Å—Å–∏–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤/–∞—Ä—Ç–∏–∫—É–ª–æ–≤/–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).

3) –ò–Ω—Å–∞–π—Ç—ã (insights)
- –í—ã–≤–æ–¥—ã –ø–æ —Ç—Ä–µ–Ω–¥–∞–º (—Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å).
- –¢–æ–≤–∞—Ä—ã‚Äë–¥—Ä–∞–π–≤–µ—Ä—ã –≤—ã—Ä—É—á–∫–∏, —Ç–æ–≤–∞—Ä—ã —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º —Ä–æ—Å—Ç–∞.
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –∞–∫—Ü–∏—è–º–∏/—Ü–µ–Ω–æ–π/–æ—Å—Ç–∞—Ç–∫–∞–º–∏ (–µ—Å–ª–∏ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø–æ –¥–∞–Ω–Ω—ã–º).
- –ö–∞–∂–¥—ã–π –∏–Ω—Å–∞–π—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
  - `title`: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–Ω—Å–∞–π—Ç–∞.
  - `detail`: –∫—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ.

4) –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (recommendations)
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π –¥–µ–π—Å—Ç–≤–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞:
  - `replenish_stock`: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤.
  - `price_adjustment`: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ü–µ–Ω—ã.
  - `promo`: –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ü–∏–π.
  - `catalog_cleanup`: –ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫, –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Ñ–æ—Ç–æ.
- –î–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
  - `action`: –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –¥–µ–π—Å—Ç–≤–∏—è.
  - `why`: –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö.
  - `impact`: –æ–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç (`low` | `medium` | `high`).
  - `effort`: —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã (`low` | `medium` | `high`).
  - `items`: –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ.

5) Telegram‚Äë–≤—ã–≤–æ–¥ (telegram)
- –°—Ñ–æ—Ä–º–∏—Ä—É–π —á–µ–ª–æ–≤–µ–∫–æ‚Äë—á–∏—Ç–∞–µ–º–æ–µ —Ä–µ–∑—é–º–µ:
  - –°–≤–µ—Ä—Ö—É: —Å–≤–æ–¥–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫.
  - –î–∞–ª–µ–µ: –∫—Ä–∞—Ç–∫–æ –∞–Ω–æ–º–∞–ª–∏–∏ (—Ç–æ–ª—å–∫–æ —Ç–æ–ø–æ–≤—ã–µ –ø–æ `severity`).
  - –ó–∞—Ç–µ–º: 2‚Äì4 –∏–Ω—Å–∞–π—Ç–∞.
  - –í –∫–æ–Ω—Ü–µ: 3‚Äì5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
- –û–±–µ—Å–ø–µ—á—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MarkdownV2: –∏–∑–±–µ–≥–∞–π –ª–∏—à–Ω–∏—Ö —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤, –Ω–µ —É—Å–ª–æ–∂–Ω—è–π —Ä–∞–∑–º–µ—Ç–∫—É.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
  - –ö–∞–∂–¥—ã–π –±–ª–æ–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å ~3500 —Å–∏–º–≤–æ–ª–æ–≤ (—Å–µ—Ä–≤–∏—Å —Å–∞–º —Ä–∞–∑–æ–±—å—ë—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
  - –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —ç–º–æ–¥–∑–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã —É–º–µ—Ä–µ–Ω–Ω–æ (üìà, ‚ö†Ô∏è, ‚úÖ).
- –í–µ—Ä–Ω–∏ –ª–∏–±–æ `telegram.mdv2` (–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π), –ª–∏–±–æ –º–∞—Å—Å–∏–≤ `telegram.chunks` (–Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞).

6) Sheets‚Äë–≤—ã–≤–æ–¥ (sheets)
- –ü—Ä–∏–≥–æ–¥–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É:
  - `headers`: —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫.
  - `rows`: –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–º–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤), –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞–º.
- –ü—Ä–∏–º–µ—Ä –∫–æ–ª–æ–Ω–æ–∫: `["SKU", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–í—ã—Ä—É—á–∫–∞ ‚ÇΩ", "–ó–∞–∫–∞–∑—ã", "–û—Å—Ç–∞—Ç–æ–∫"]`.
- –í–∫–ª—é—á–∞–π —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ; –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ø—É—Å—Ç–∏–º—ã, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.

---

## OUTPUT_JSON_SCHEMA
–¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON. –í–µ—Ä–Ω–∏ `OUTPUT_JSON` —Å—Ç—Ä–æ–≥–æ –ø–æ —ç—Ç–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.

```json
{
  "key_metrics": {
    "date_range": {
      "start_date": "YYYY-MM-DD",
      "end_date": "YYYY-MM-DD"
    },
    "orders_count": 0,
    "revenue_rub": 0,
    "avg_order_value": 0,
    "day_over_day": 0,
    "week_over_week": 0,
    "top_products_count": 0,
    "critical_stocks_count": 0
  },
  "anomalies": [
    {
      "type": "revenue_drop",
      "description": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
      "severity": "high",
      "affected_items": ["SKU-1", "SKU-2"]
    }
  ],
  "insights": [
    {
      "title": "–¢–æ–ø-—Ç–æ–≤–∞—Ä –¥–∞–ª 40% –≤—ã—Ä—É—á–∫–∏",
      "detail": "–ü–æ—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö"
    }
  ],
  "recommendations": [
    {
      "action": "replenish_stock",
      "why": "–û—Å—Ç–∞—Ç–∫–∏ < –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø–æ SKU-1",
      "impact": "high",
      "effort": "medium",
      "items": ["SKU-1"]
    }
  ],
  "telegram": {
    "mdv2": "–õ–∏–±–æ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Ä–∞–∑–º–µ—Ç–∫–∏ MarkdownV2",
    "chunks": ["–õ–∏–±–æ –º–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞"]
  },
  "sheets": {
    "headers": ["SKU", "–ù–∞–∑–≤–∞–Ω–∏–µ", "–í—ã—Ä—É—á–∫–∞ ‚ÇΩ", "–ó–∞–∫–∞–∑—ã", "–û—Å—Ç–∞—Ç–æ–∫"],
    "rows": [
      ["SKU-1", "–¢–æ–≤–∞—Ä 1", 120000, 45, 8]
    ]
  }
}
```

–ñ—ë—Å—Ç–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í—Å–µ –∫–ª—é—á–∏ –æ–±—è–∑–∞–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å (–¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø—É—Å—Ç—ã–µ/–Ω—É–ª–µ–≤—ã–µ).
- `telegram` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–∏–±–æ –Ω–µ–ø—É—Å—Ç–æ–π `chunks`, –ª–∏–±–æ –Ω–µ–ø—É—Å—Ç–æ–π `mdv2`.
- `sheets.headers` –∏ `sheets.rows` ‚Äî –º–∞—Å—Å–∏–≤—ã; `rows[i].length` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `headers.length`.
- –ß–∏—Å–ª–∞ ‚Äî —Ü–µ–ª—ã–µ –∏–ª–∏ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π (–≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ); –¥–∞—Ç—ã –≤ ISO‚Äë—Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD`.

---

## OUTPUT_TG_GUIDE
–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Telegram‚Äë—Å–æ–æ–±—â–µ–Ω–∏—è (—á–µ–ª–æ–≤–µ–∫–æ—Å–º–æ—Ç—Ä–∏–º–æ–µ —Ä–µ–∑—é–º–µ):

- –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∫—Ä–∞—Ç–∫–∞—è –≤–≤–æ–¥–Ω–∞—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´üìä –û—Ç—á—ë—Ç –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É: 2025‚Äë10‚Äë22¬ª).
  - –ë–ª–æ–∫ ¬´–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏¬ª (–≤—ã—Ä—É—á–∫–∞, –∑–∞–∫–∞–∑—ã, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –¥–∏–Ω–∞–º–∏–∫–∞).
  - –ë–ª–æ–∫ ¬´–ê–Ω–æ–º–∞–ª–∏–∏¬ª (—Ç–æ–ø‚Äë3 –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏).
  - –ë–ª–æ–∫ ¬´–ò–Ω—Å–∞–π—Ç—ã¬ª (2‚Äì4 –ø—É–Ω–∫—Ç–∞).
  - –ë–ª–æ–∫ ¬´–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏¬ª (3‚Äì5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π).
- –†–∞–∑–º–µ—Ç–∫–∞:
  - –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –º–∞—Ä–∫–µ—Ä—ã —Å–ø–∏—Å–∫–∞.
  - –ò–∑–±–µ–≥–∞–π —Å–ª–æ–∂–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏; —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (`_ * [ ] ( ) ~ > # + - = | { } . !`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã ‚Äî —Å–µ—Ä–≤–∏—Å —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç, –Ω–æ –Ω–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π –∏–º–∏.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
  - –î–æ ~3500 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –±–ª–æ–∫ (—Å–µ—Ä–≤–∏—Å —Ä–∞–∑–±–∏–≤–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã).
  - –ù–µ –≤–∫–ª—é—á–∞–π –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–µ–∫—Å—Ç–æ–º ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sheets`.
- –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø—Ä–∏–º–µ—Ä–Ω–æ):
  ```
  üìä –û—Ç—á—ë—Ç –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É: 2025‚Äë10‚Äë22

  üìà –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  ‚Ä¢ –í—ã—Ä—É—á–∫–∞: 1‚ÄØ200‚ÄØ000‚ÇΩ
  ‚Ä¢ –ó–∞–∫–∞–∑—ã: 450
  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: 2‚ÄØ670‚ÇΩ
  ‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –∫ –≤—á–µ—Ä–∞: +8%

  ‚ö†Ô∏è –ê–Ω–æ–º–∞–ª–∏–∏
  ‚Ä¢ –ü–∞–¥–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã¬ª (severity: medium)
  ‚Ä¢ –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ SKU-123 (8 —à—Ç., —Ä–∏—Å–∫ —Å—Ç–æ–∫-–∞—É—Ç–∞)

  üîç –ò–Ω—Å–∞–π—Ç—ã
  ‚Ä¢ –¢–æ–ø‚Äë—Ç–æ–≤–∞—Ä—ã –¥–∞—é—Ç 65% –≤—ã—Ä—É—á–∫–∏
  ‚Ä¢ –†–æ—Å—Ç –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö

  ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  ‚Ä¢ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ SKU-123 (impact: high, effort: medium)
  ‚Ä¢ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ü–µ–Ω—É SKU-456 (impact: medium, effort: low)
  ‚Ä¢ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–∫—Ü–∏—é –Ω–∞ —Ç–æ–ø‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏—é (impact: high, effort: medium)
  ```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî –ø—Ä—è–º–æ –æ–± —ç—Ç–æ–º —Å–æ–æ–±—â–∏ –≤ ¬´–ê–Ω–æ–º–∞–ª–∏–∏¬ª –∏ –¥–∞–π –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –¥–æ–ø—É—â–µ–Ω–∏—è–º–∏.
- –ù–µ –æ–±–µ—â–∞–π —ç—Ñ—Ñ–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## –¢–ó: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–±–æ—Ç ‚Üí GPT ‚Üí —Å–µ—Ä–≤–µ—Ä)

–¶–µ–ª—å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–Ω–æ–ø–∫—É ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª –≤ –±–æ—Ç–µ, –∑–∞–ø—É—Å–∫–∞—é—â—É—é —Å–±–æ—Ä e‚Äëcommerce –¥–∞–Ω–Ω—ã—Ö, LLM‚Äë–∞–Ω–∞–ª–∏–∑ –ø–æ —à–∞–±–ª–æ–Ω—É –∏ –¥–æ—Å—Ç–∞–≤–∫—É –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –≤ Telegram.
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∫–ª—é—á–∞–µ—Ç Telegram‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ (MarkdownV2) –∏, –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏, –¥–∞–Ω–Ω—ã–µ –¥–ª—è Google Sheets (headers + rows) –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `OUTPUT_JSON_SCHEMA`.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
  - `bot` (Telegram –±–æ—Ç, –ø–æ—Ä—Ç `8001`) ‚Äî –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
  - `gpt_integration` (–ø–æ—Ä—Ç `9000`) ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞, LLM‚Äë–∫–ª–∏–µ–Ω—Ç, –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä.
  - `server` (–ø–æ—Ä—Ç `8000`) ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (Bot API).
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
  1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª –≤ –º–µ–Ω—é AI‚Äë–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.
  2) –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç `POST` –Ω–∞ `gpt_integration /v1/analysis/start` —Å `telegram_id` (+ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `period`).
  3) GPT‚Äë—Å–µ—Ä–≤–∏—Å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–≤–æ–¥–∫–∏ –≤ `server` (`/api/v1/bot/...`), –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
  4) –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –ø–æ `LLM_ANALYSIS_TEMPLATE.md` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç LLM.
  5) –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç `OUTPUT_JSON` (—Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç), –≥–æ—Ç–æ–≤–∏—Ç Telegram‚Äë—Ç–µ–∫—Å—Ç.
  6) –®–ª—ë—Ç –≤–µ–±—Ö—É–∫ –≤ `bot /webhook/notifications/{telegram_id}` —Å —Ç–∏–ø–æ–º `analysis_completed` –∏ –≥–æ—Ç–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º.
  7) –ë–æ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–æ—Ç–µ
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
  - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª –≤ `ai_assistant_keyboard`.
- –•–µ–Ω–¥–ª–µ—Ä:
  - –í `bot/handlers/gpt.py` –¥–æ–±–∞–≤–∏—Ç—å callback `cb_ai_analysis`:
    - –ü–æ–ª—É—á–∞–µ—Ç `telegram_id`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST` –Ω–∞ `GPT_SERVICE_URL/v1/analysis/start`.
    - –ë—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ¬´–ó–∞–ø—É—Å–∫–∞—é –∞–Ω–∞–ª–∏–∑‚Ä¶ –°–æ–æ–±—â—É –ø–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏¬ª.
    - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏ —Å–æ–æ–±—â–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è.

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- Bot ‚Üí GPT: —Å—Ç–∞—Ä—Ç –∞–Ω–∞–ª–∏–∑–∞
  - `POST {GPT_SERVICE_URL}/v1/analysis/start`
  - –¢–µ–ª–æ (JSON):
    ```json
    {
      "telegram_id": 123456789,
      "period": "7d",
      "validate_output": true
    }
    ```
  - –û—Ç–≤–µ—Ç 202:
    ```json
    { "status": "accepted", "message": "analysis started" }
    ```
- GPT ‚Üí Server: —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
  - –ë–∞–∑–æ–≤—ã–π URL: `SERVER_HOST` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://server:8000`)
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: `X-API-KEY: {API_SECRET_KEY}`
  - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã; —Ä–∞—Å—à–∏—Ä—è–µ–º—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö):
    - `GET /api/v1/bot/analytics/sales?telegram_id={id}&period={period}`
    - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
      - `GET /api/v1/bot/stocks/critical?telegram_id={id}`
      - `GET /api/v1/bot/reviews/summary?telegram_id={id}`
      - `GET /api/v1/bot/orders/recent?telegram_id={id}`
- GPT ‚Üí Bot: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ‚Äë–≤–µ–±—Ö—É–∫
  - `POST {BOT_WEBHOOK_BASE}/webhook/notifications/{telegram_id}`
  - –¢–µ–ª–æ (JSON):
    ```json
    {
      "telegram_id": 123456789,
      "user_id": 42,
      "type": "analysis_completed",
      "telegram_text": "üìä –û—Ç—á—ë—Ç –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É: 2025-10-22\n\nüìà –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏\n..."
    }
    ```
  - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–ª—è —Ç–∏–ø–æ–≤, –æ—Ç–ª–∏—á–Ω—ã—Ö –æ—Ç `sync_completed`, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `telegram_text` –∫–∞–∫ –µ—Å—Ç—å.

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `DATA` –¥–ª—è —à–∞–±–ª–æ–Ω–∞
- –ò—Å—Ö–æ–¥–Ω—ã–µ –±–ª–æ–∫–∏ (–ø—Ä–∏–º–µ—Ä; –Ω–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ Bot API):
  ```json
  {
    "date_range": { "start_date": "2025-10-15", "end_date": "2025-10-22" },
    "sales": {
      "orders_count": 450,
      "revenue_rub": 1200000,
      "avg_order_value": 2670,
      "daily": [ { "date": "2025-10-21", "orders": 410, "revenue_rub": 1100000 } ],
      "weekly": [ { "week": "2025-W42", "orders": 3000, "revenue_rub": 8000000 } ]
    },
    "stocks_critical": [
      { "sku": "SKU-123", "name": "–¢–æ–≤–∞—Ä 1", "stock": 8 }
    ],
    "reviews_summary": {
      "negative_ratio": 0.12,
      "top_negative_items": [ "SKU-555" ]
    },
    "top_products": [
      { "sku": "SKU-321", "name": "–¢–æ–ø —Ç–æ–≤–∞—Ä", "revenue_rub": 480000, "orders": 160 }
    ]
  }



## –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–≠—Ç–∞–ø 0 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `docker-compose.yml`: —Å–µ—Ä–≤–∏—Å—ã `bot:8001`, `gpt:9000`, `server:8000` –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏.
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ `gpt_integration/requirements.txt` –µ—Å—Ç—å HTTP‚Äë–∫–ª–∏–µ–Ω—Ç (`httpx`) –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ LLM.
- –ó–∞–≤–µ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  - Bot: `GPT_SERVICE_URL`
  - GPT‚Äë—Å–µ—Ä–≤–∏—Å: `SERVER_HOST`, `API_SECRET_KEY`, `BOT_WEBHOOK_BASE`, `OPENAI_API_KEY`, `OPENAI_BASE_URL`, `OPENAI_MODEL`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ `/health` –¥–ª—è GPT‚Äë—Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç.

–≠—Ç–∞–ø 1 ‚Äî UI –≤ –±–æ—Ç–µ: –∫–Ω–æ–ø–∫–∞ ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ `bot/keyboards/keyboards.py` ‚Üí `ai_assistant_keyboard`.
- –°–≤—è–∑–∞—Ç—å —Å callback‚Äë–¥–∞–Ω–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ai_analysis`).
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–Ω–æ–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –º–µ–Ω—é ¬´AI‚Äë–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç¬ª.

–≠—Ç–∞–ø 2 ‚Äî –•–µ–Ω–¥–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤ –±–æ—Ç–µ
- –í `bot/handlers/gpt.py` –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `cb_ai_analysis`:
  - –ë–µ—Ä—ë—Ç `telegram_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
  - –î–µ–ª–∞–µ—Ç `POST` –Ω–∞ `{GPT_SERVICE_URL}/v1/analysis/start` —Å —Ç–µ–ª–æ–º `{ telegram_id, period?, validate_output? }`.
  - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ¬´–ó–∞–ø—É—Å–∫–∞—é –∞–Ω–∞–ª–∏–∑‚Ä¶¬ª –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏.
- –í `bot/core/config.py` –¥–æ–±–∞–≤–∏—Ç—å `gpt_service_url` –≤ `BotConfig` –∏ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ `.env`.
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –±–æ—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏ –¥–∞—ë—Ç –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç.

–≠—Ç–∞–ø 3 ‚Äî –≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤ GPT‚Äë—Å–µ—Ä–≤–∏—Å–µ
- –í `gpt_integration/service.py` —Å–æ–∑–¥–∞—Ç—å `POST /v1/analysis/start` (async):
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–∞ (`telegram_id`, `period?`, `validate_output?`).
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `request_id` –∏ `telegram_id`.
  - –û—Ç–≤–µ—Ç `202 accepted` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏).
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç –±–æ—Ç–∞ –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤–æ—Ä–∫—Ñ–ª–æ—É.

–≠—Ç–∞–ø 4 ‚Äî –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ Server (Bot API)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ GPT‚Äë—Å–µ—Ä–≤–∏—Å–µ (—á–µ—Ä–µ–∑ `httpx.AsyncClient`) –∫:
  - `GET /api/v1/bot/analytics/sales?telegram_id={id}&period={period}`
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `stocks/critical`, `reviews/summary`, `orders/recent`.
- –í `gpt_integration/aggregator.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é:
  - –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å `day_over_day`, `week_over_week`, `top_products_count`, `critical_stocks_count`.
  - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π `data` –¥–ª—è —à–∞–±–ª–æ–Ω–∞.
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç `data` –≥–æ—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω.

–≠—Ç–∞–ø 5 ‚Äî –ó–∞–ø—É—Å–∫ LLM —á–µ—Ä–µ–∑ –ø–∞–π–ø–ª–∞–π–Ω
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `gpt_integration/pipeline.py::run_analysis`:
  - `template_path = "gpt_integration/LLM_ANALYSIS_TEMPLATE.md"`
  - `validate_output = true` –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ `OUTPUT_JSON_SCHEMA`.
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ JSON, –æ—à–∏–±–∫–∏ LLM, —Ä–µ—Ç—Ä–∞–∏ (–ø–æ –∫–æ–Ω—Ñ–∏–≥—É).
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—É—á–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π `OUTPUT_JSON` —Å –±–ª–æ–∫–∞–º–∏ `telegram` –∏ `sheets`.

–≠—Ç–∞–ø 6 ‚Äî –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±–æ—Ç (–≤–µ–±—Ö—É–∫)
- –í GPT‚Äë—Å–µ—Ä–≤–∏—Å–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `POST {BOT_WEBHOOK_BASE}/webhook/notifications/{telegram_id}`:
  - –¢–µ–ª–æ: `{ telegram_id, user_id?, type: "analysis_completed", telegram_text }`.
- –í `bot/handlers/webhook.py` —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–æ).
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç –≤ Telegram.

–≠—Ç–∞–ø 7 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–æ–¥—Ç—è–Ω—É—Ç—å `API_SECRET_KEY` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Server.
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã HTTP, –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ç—Ä–∞–∏ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ) –≤ GPT‚Äë—Å–µ—Ä–≤–∏—Å–µ.
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ–±—Ö—É–∫–∞ –≤ –±–æ—Ç–µ (–≤ —Ç–µ—Å—Ç–∞—Ö –æ—Ç–∫–ª—é—á–µ–Ω–æ).
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —É—Å—Ç–æ–π—á–∏–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤.

–≠—Ç–∞–ø 8 ‚Äî –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- –í–µ–∑–¥–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å `level=INFO/WARN/ERROR`, `telegram_id`, `request_id`.
- –ú–µ—Ç—Ä–∏–∫–∏ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏): –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∞–ø–æ–≤, —Ä–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö, —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫.
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–Ω—è—Ç–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º.

–≠—Ç–∞–ø 9 ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –Æ–Ω–∏—Ç (GPT‚Äë—Å–µ—Ä–≤–∏—Å): —Ç–µ—Å—Ç `run_analysis` –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ `OUTPUT_JSON_SCHEMA`, –Ω–µ–ø—É—Å—Ç–æ–π `telegram`.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
  - –°–º–æ—É–∫: `POST /v1/analysis/start` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–æ—Ç.
  - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π Server/Bot, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è.
- –†—É—á–Ω–æ–µ: –Ω–∞–∂–∞—Ç—å ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª ‚Üí –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏, –∏–Ω—Å–∞–π—Ç–∞–º–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, —Ä—É—á–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —É—Å–ø–µ—à–µ–Ω.

–≠—Ç–∞–ø 10 ‚Äî –î–µ–ø–ª–æ–π –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`: –ø—Ä–æ–∫–∏–Ω—É—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `bot` –∏ `gpt`.
- –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `/health` –∏ –ø—Ä–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞.
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–±–æ—á–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Definition of Done)
- –ö–Ω–æ–ø–∫–∞ ¬´üß† –ê–Ω–∞–ª–∏–∑¬ª –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å; –±–æ—Ç —Å—Ä–∞–∑—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å—Ç–∞—Ä—Ç.
- GPT‚Äë—Å–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç LLM –ø–æ —à–∞–±–ª–æ–Ω—É, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç (MarkdownV2), –æ—à–∏–±–∫–∏ —Å–æ–æ–±—â–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤ Docker; –ª–æ–≥–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.