# üîÑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã gpt_integration

## –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
gpt_integration/
‚îú‚îÄ‚îÄ __init__.py              # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å —Å —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏
‚îú‚îÄ‚îÄ gpt_client.py            # –û–±—â–∏–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GPT (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏)
‚îú‚îÄ‚îÄ service.py               # –ì–ª–∞–≤–Ω—ã–π FastAPI —Ä–æ—É—Ç–µ—Ä (—Ä–æ—É—Ç–∏–Ω–≥ –Ω–∞ –º–æ–¥—É–ª–∏)
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ env_example.txt
‚îú‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ analysis/                # üìä –ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ service.py           # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞, fetch —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ aggregator.py        # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py          # –ü–∞–π–ø–ª–∞–π–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ template_loader.py   # –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ LLM_ANALYSIS_TEMPLATE.md
‚îÇ
‚îú‚îÄ‚îÄ ai_chat/                 # üí¨ –ú–æ–¥—É–ª—å –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ service.py           # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ card_generation/         # üé® –ú–æ–¥—É–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ service.py           # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤

### –°—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã:
```python
from gpt_integration.pipeline import run_analysis
from gpt_integration.aggregator import aggregate
from gpt_integration.template_loader import get_system_prompt
```

### –ù–æ–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã:
```python
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò–∑ –º–æ–¥—É–ª—è –Ω–∞–ø—Ä—è–º—É—é
from gpt_integration.analysis.pipeline import run_analysis
from gpt_integration.analysis.aggregator import aggregate
from gpt_integration.analysis.template_loader import get_system_prompt

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
from gpt_integration import run_analysis, aggregate, get_system_prompt

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ò–º–ø–æ—Ä—Ç –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è
from gpt_integration.analysis import run_analysis, aggregate
```

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏:
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `POST /v1/chat` - –ø—Ä–æ—Å—Ç–æ–π —á–∞—Ç (–º–æ–¥—É–ª—å `ai_chat`)
- `POST /v1/analysis` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–º–æ–¥—É–ª—å `analysis`)
- `POST /v1/analysis/start` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ (–º–æ–¥—É–ª—å `analysis`)
- `POST /v1/card/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–æ–¥—É–ª—å `card_generation`)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Å–≤–æ–µ–º –º–æ–¥—É–ª–µ
2. ‚úÖ **–õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–æ–¥—É–ª–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
3. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏
4. ‚úÖ **–ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, –∫–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

## –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–¥–∞

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã, –æ–±–Ω–æ–≤–∏—Ç–µ –∏—Ö:

```python
# ‚ùå –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
from gpt_integration.pipeline import run_analysis

# ‚úÖ –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±
from gpt_integration.analysis.pipeline import run_analysis
# –∏–ª–∏
from gpt_integration import run_analysis
```

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ü–µ—Ä–µ–º–µ—â–µ–Ω–Ω—ã–µ:
- `aggregator.py` ‚Üí `analysis/aggregator.py`
- `pipeline.py` ‚Üí `analysis/pipeline.py`
- `template_loader.py` ‚Üí `analysis/template_loader.py`
- `LLM_ANALYSIS_TEMPLATE.md` ‚Üí `analysis/LLM_ANALYSIS_TEMPLATE.md`

### –ù–æ–≤—ã–µ:
- `analysis/service.py` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞
- `analysis/__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥—É–ª—è
- `ai_chat/service.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç–∞
- `ai_chat/__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥—É–ª—è
- `card_generation/service.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ (–∑–∞–≥–ª—É—à–∫–∞)
- `card_generation/__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥—É–ª—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ:
- `service.py` - —Ç–µ–ø–µ—Ä—å —Ä–æ—É—Ç–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª–∏
- `__init__.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤:
- ‚úÖ `bot/tests/unit/test_llm_pipeline_stage3.py`
- ‚úÖ `bot/tests/unit/test_aggregator_stage3.py`
- ‚úÖ `bot/tests/manual_pipeline_smoke.py`

---

**–î–∞—Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 2025-11-03  
**–í–µ—Ä—Å–∏—è:** 2.0

